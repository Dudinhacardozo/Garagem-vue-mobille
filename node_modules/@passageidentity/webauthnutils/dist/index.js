var n=(e,r,i)=>new Promise((t,a)=>{var u=s=>{try{c(i.next(s))}catch(p){a(p)}},g=s=>{try{c(i.throw(s))}catch(p){a(p)}},c=s=>s.done?t(s.value):Promise.resolve(s.value).then(u,g);c((i=i.apply(e,r)).next())});var C=(e,r)=>n(void 0,null,function*(){let i,t=new Promise(a=>{i=setTimeout(a,r)});return Promise.race([e,t]).then(a=>(clearTimeout(i),a))});var o=class{static encodeBytes(e){let r=btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_");return P(r)}static decodeBytes(e){let r=e.replace(/-/g,"+").replace(/_/g,"/"),i=P(r);return Uint8Array.from(atob(i),t=>t.charCodeAt(0))}},P=e=>{let r=e.indexOf("=");return e.slice(0,r===-1?e.length:r)},m=(e=>(e.Platform="platform",e.CrossPlatform="cross-platform",e.Any="any",e))(m||{});var f=(e=>(e[e.MultipleChoice=300]="MultipleChoice",e[e.MovedPermanantly=301]="MovedPermanantly",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.URITooLong=414]="URITooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HTTPVersionNotSupported=505]="HTTPVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",e[e.PSGCredObjectDoesNotExist=700]="PSGCredObjectDoesNotExist",e[e.PSGParsePublicKeyForNewDeviceFailed=701]="PSGParsePublicKeyForNewDeviceFailed",e[e.PSGParsePublicKeyForLoginFailed=702]="PSGParsePublicKeyForLoginFailed",e[e.PSGCouldNotGetUserCredential=703]="PSGCouldNotGetUserCredential",e[e.PSGLoginRequired=704]="PSGLoginRequired",e[e.PSGSecureContextRequired=705]="PSGSecureContextRequired",e[e.PSGSocialSessionStorageError=706]="PSGSocialSessionStorageError",e[e.PSGParsePublicKeyForRegistrationFailed=707]="PSGParsePublicKeyForRegistrationFailed",e[e.PSGCanAuthenticateWithPasskeyFailed=708]="PSGCanAuthenticateWithPasskeyFailed",e[e.PSGCanRegisterWithPasskeyFailed=709]="PSGCanRegisterWithPasskeyFailed",e[e.PSGCanUseConditionalMediationFailed=710]="PSGCanUseConditionalMediationFailed",e[e.PSGAuthOriginConfigurationError=711]="PSGAuthOriginConfigurationError",e))(f||{});var d=class{static createCredentialAvailable(){return n(this,null,function*(){let r={securityKey:!1,platform:!1,isAvailable:!1};return window.PublicKeyCredential&&(r.securityKey=!0,r.isAvailable=!0,yield C(window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then(i=>{r.platform=i}).catch(()=>console.log("Something went wrong.")),1e3)),r})}static parsePublicKey(r){if(r.challenge=o.decodeBytes(r.challenge.toString()),r.user.id=o.decodeBytes(r.user.id.toString()),r.excludeCredentials)for(let i=0;i<r.excludeCredentials.length;i++){let t=r.excludeCredentials[i];t.id=o.decodeBytes(t.id.toString())}return r}static getTransports(r){let i=[];return r.response.getTransports&&typeof r.response.getTransports=="function"&&(i=r.response.getTransports()),i}static createCredential(r){return n(this,null,function*(){let i={credential:null,transports:[]},t=this.parsePublicKey(r),a=yield navigator.credentials.create({publicKey:t}).then(u=>u);return a==null||(i.credential=a,i.transports=this.getTransports(a)),i})}};import b from"ua-parser-js";var l=class{constructor(){this.userAgent=new b}getSyncedCredential(){return!!(this._isiOSPasskeySupported()||this._isMacPasskeySupported()||this._isChromeSyncedCredential()||this._isFireFoxPasskeySupported())}getCrossDeviceCredential(){return!!(this._isiOSPasskeySupported()||this._isMacPasskeySupported()||this._isChromiumCrossDevice()||this._isFireFoxPasskeySupported())}_isiOSPasskeySupported(){return this.userAgent.getOS().name=="iOS"&&parseFloat(this.userAgent.getOS().version||"")>=16}_isMacPasskeySupported(){return this.userAgent.getBrowser().name=="Safari"&&parseFloat(this.userAgent.getBrowser().version||"")>=16&&this.userAgent.getOS().name=="Mac OS"}_isChromeSyncedCredential(){var t;let r=(t=this.userAgent.getOS().name)!=null?t:"";return((r==null?void 0:r.includes("Windows"))||(r==null?void 0:r.includes("Mac OS"))||(r==null?void 0:r.includes("Android")))&&this.userAgent.getBrowser().name=="Chrome"&&parseFloat(this.userAgent.getBrowser().version||"")>=108}_isChromiumCrossDevice(){return this.userAgent.getOS().name==="Android"?!1:this.userAgent.getEngine().name=="Blink"&&parseFloat(this.userAgent.getBrowser().version||"")>=109}_isFireFoxPasskeySupported(){return this.userAgent.getBrowser().name=="Firefox"&&parseFloat(this.userAgent.getBrowser().version||"")>=122}};var y=class{static parsePublicKey(r){if(r.challenge=o.decodeBytes(r.challenge.toString()),r.allowCredentials){for(let i=0;i<r.allowCredentials.length;i++){let t=r.allowCredentials[i];t.id=o.decodeBytes(t.id.toString())}return r}return r}static getCredential(r,i){return n(this,null,function*(){return yield navigator.credentials.get({mediation:i==null?void 0:i.mediation,signal:i==null?void 0:i.signal,publicKey:this.parsePublicKey(r)}).then(a=>a).catch(a=>(console.info(a),null))})}static getCredentialAvailable(){return n(this,null,function*(){let r={securityKey:!1,platform:!1,syncedCredential:!1,crossDeviceCredential:!1,conditionalUI:!1,isAvailable:!1},i=yield d.createCredentialAvailable();if(r.securityKey=i.securityKey,r.platform=i.platform,r.isAvailable=i.isAvailable,!r.securityKey)return r;let t=yield this._getClientCapabalities();if(t!==void 0)return t;r.conditionalUI=yield this._isConditionalMediationAvailable();let a=new l;return r.syncedCredential=a.getSyncedCredential(),r.crossDeviceCredential=a.getCrossDeviceCredential(),r})}static _isConditionalMediationAvailable(){return n(this,null,function*(){return PublicKeyCredential.isConditionalMediationAvailable?yield PublicKeyCredential.isConditionalMediationAvailable():!1})}static _getClientCapabalities(){return n(this,null,function*(){if(window.PublicKeyCredential){let r=window.PublicKeyCredential;if(r.getClientCapabilities){let i=yield r.getClientCapabilities();return{securityKey:!0,platform:i.userVerifyingPlatformAuthenticator,syncedCredential:i.passkeyPlatformAuthenticator,crossDeviceCredential:i.hybridTransport,conditionalUI:i.conditionalMediation,isAvailable:!0}}}})}};export{d as CreateCredentialUtils,y as GetCredentialUtils};
//# 