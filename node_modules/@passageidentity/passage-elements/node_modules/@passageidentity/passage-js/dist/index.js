import{CreateCredentialUtils as J,GetCredentialUtils as X}from"@passageidentity/webauthnutils";var c=class{static encodeBytes(t){let e=btoa(String.fromCharCode(...new Uint8Array(t))).replace(/\+/g,"-").replace(/\//g,"_");return j(e)}static decodeBytes(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),r=j(e);return Uint8Array.from(atob(r),o=>o.charCodeAt(0))}},j=t=>{let e=t.indexOf("=");return t.slice(0,e===-1?t.length:e)},T=(t=>(t.Platform="platform",t.CrossPlatform="cross-platform",t.Any="any",t))(T||{}),u=class extends Error{statusCode;statusText;message;name;constructor(t,e){super(),this.name="PassageError",this.statusCode=e.status,this.statusText=e.statusText,this.message=this._parsePsgErrorResponse(t)}_parsePsgErrorResponse(t){try{return t=JSON.parse(t),t.error?t.error:""}catch{return t}}},g=(t=>(t[t.MultipleChoice=300]="MultipleChoice",t[t.MovedPermanantly=301]="MovedPermanantly",t[t.Found=302]="Found",t[t.SeeOther=303]="SeeOther",t[t.NotModified=304]="NotModified",t[t.TemporaryRedirect=307]="TemporaryRedirect",t[t.PermanentRedirect=308]="PermanentRedirect",t[t.BadRequest=400]="BadRequest",t[t.Unauthorized=401]="Unauthorized",t[t.PaymentRequired=402]="PaymentRequired",t[t.Forbidden=403]="Forbidden",t[t.NotFound=404]="NotFound",t[t.MethodNotAllowed=405]="MethodNotAllowed",t[t.NotAcceptable=406]="NotAcceptable",t[t.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",t[t.RequestTimeout=408]="RequestTimeout",t[t.Conflict=409]="Conflict",t[t.Gone=410]="Gone",t[t.LengthRequired=411]="LengthRequired",t[t.PreconditionFailed=412]="PreconditionFailed",t[t.PayloadTooLarge=413]="PayloadTooLarge",t[t.URITooLong=414]="URITooLong",t[t.UnsupportedMediaType=415]="UnsupportedMediaType",t[t.RangeNotSatisfiable=416]="RangeNotSatisfiable",t[t.ExpectationFailed=417]="ExpectationFailed",t[t.MisdirectedRequest=421]="MisdirectedRequest",t[t.UnprocessableEntity=422]="UnprocessableEntity",t[t.Locked=423]="Locked",t[t.FailedDependency=424]="FailedDependency",t[t.TooEarly=425]="TooEarly",t[t.UpgradeRequired=426]="UpgradeRequired",t[t.PreconditionRequired=428]="PreconditionRequired",t[t.TooManyRequests=429]="TooManyRequests",t[t.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",t[t.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",t[t.InternalServerError=500]="InternalServerError",t[t.NotImplemented=501]="NotImplemented",t[t.BadGateway=502]="BadGateway",t[t.ServiceUnavailable=503]="ServiceUnavailable",t[t.GatewayTimeout=504]="GatewayTimeout",t[t.HTTPVersionNotSupported=505]="HTTPVersionNotSupported",t[t.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",t[t.InsufficientStorage=507]="InsufficientStorage",t[t.LoopDetected=508]="LoopDetected",t[t.NotExtended=510]="NotExtended",t[t.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",t[t.PSGCredObjectDoesNotExist=700]="PSGCredObjectDoesNotExist",t[t.PSGParsePublicKeyForNewDeviceFailed=701]="PSGParsePublicKeyForNewDeviceFailed",t[t.PSGParsePublicKeyForLoginFailed=702]="PSGParsePublicKeyForLoginFailed",t[t.PSGCouldNotGetUserCredential=703]="PSGCouldNotGetUserCredential",t[t.PSGLoginRequired=704]="PSGLoginRequired",t[t.PSGSecureContextRequired=705]="PSGSecureContextRequired",t[t.PSGSocialSessionStorageError=706]="PSGSocialSessionStorageError",t[t.PSGParsePublicKeyForRegistrationFailed=707]="PSGParsePublicKeyForRegistrationFailed",t[t.PSGCanAuthenticateWithPasskeyFailed=708]="PSGCanAuthenticateWithPasskeyFailed",t[t.PSGCanRegisterWithPasskeyFailed=709]="PSGCanRegisterWithPasskeyFailed",t[t.PSGCanUseConditionalMediationFailed=710]="PSGCanUseConditionalMediationFailed",t[t.PSGAuthOriginConfigurationError=711]="PSGAuthOriginConfigurationError",t))(g||{});async function i(t){if(!t.ok)return await t.text().then(e=>{throw new u(e,t)});if(t.status!==204)return t.json()}import L from"js-cookie";var y=class{psgCredIDExists(e){let r=e.user.id,o=e.handshake.challenge.publicKey.allowCredentials,s=this.getPsgCredObj();if(!s)throw new u("Could not get psg_cred_obj",{status:g.PSGCredObjectDoesNotExist,statusText:"PSG Cred Object Does Not Exist"});let h=JSON.parse(s)[r];return h?o.find(P=>{if(c.encodeBytes(c.decodeBytes(P.id))===c.encodeBytes(c.decodeBytes(h)))return!0}):!1}setPsgCredID(e,r){if(!r)throw new u("Could not get user's credential",{status:g.PSGCouldNotGetUserCredential,statusText:"PSG Could Not Get User Credential"});let o=this.getPsgCredObj();if(o){let s=JSON.parse(o);s[e]=r==null?void 0:r.id,this.setPsgCredObj(JSON.stringify(s))}else this.setPsgCredObj(JSON.stringify({[e]:r==null?void 0:r.id}))}removeCredential(e){let r=this.getPsgCredObj();if(r===void 0)return;let o=JSON.parse(r);Object.keys(o).forEach(s=>{o[s]===e&&delete o[s]}),this.setPsgCredObj(JSON.stringify(o))}getPsgCredObj(){let e=L.get("psg_cred_obj"),r=localStorage.getItem("psg_cred_obj");if(e!==void 0)return L.set("psg_cred_obj",e,{expires:400,sameSite:"Strict"}),r===null&&localStorage.setItem("psg_cred_obj",e),e;if(r!==null)return L.set("psg_cred_obj",r,{expires:400,sameSite:"Strict"}),r}setPsgCredObj(e){L.set("psg_cred_obj",e,{expires:400,sameSite:"Strict"}),localStorage.setItem("psg_cred_obj",e)}};var q={URL:"https://auth.passage.id",version:"@passageidentity/passage-js 3.14.6",CAPTURE_EVENT_URL:"https://us-central1-passage-prod.cloudfunctions.net/capture-event",SENTRY_RELEASE:"passage-js@3.14.6-prod",SENTRY_PROJECT:"passage-js",SENTRY_PROJECT_DSN:"",SENTRY_PROJECT_ENV:"prod",SENTRY_PROJECT_VERSION:"3.14.6"};var f=q;function n(t){var s;let e=new Headers(t),r=f.version,o=f.EXTRA_HEADERS;if(r&&e.append("Passage-Version",r),o){let h=((s=o.find(a=>a.hasOwnProperty("elementVersion")))==null?void 0:s.elementVersion)||null;h&&e.append("Passage-Element-Version",h)}return e}var B=class{getRefreshToken(){return Promise.resolve(void 0)}},G=class extends B{clearTokens(){return Promise.resolve()}},N=class extends G{constructor(){super(...arguments);this.noLocalStorage=typeof window>"u";this.noLocalStorageError=r=>"Failed to access localStorage or cookies. Must be run client-side."}getAuthToken(){if(this.noLocalStorage)return Promise.reject(this.noLocalStorageError("getAuthToken"));let r=localStorage.getItem("psg_auth_token");return r===null?Promise.resolve(""):Promise.resolve(r)}setAuthToken(r){if(this.noLocalStorage)return Promise.reject(this.noLocalStorageError("setAuthToken"));localStorage.setItem("psg_auth_token",r);let o=!this._isHttps()&&this._isLocalHost();return document.cookie=`psg_auth_token = ${r}; path=/ ${o?"":";secure"}`,Promise.resolve()}getRefreshToken(){this.noLocalStorage&&Promise.reject(this.noLocalStorageError("getRefreshToken"));let r=localStorage.getItem("psg_refresh_token");return r===null?Promise.resolve(void 0):Promise.resolve(r)}setRefreshToken(r){return this.noLocalStorage&&Promise.reject(this.noLocalStorageError("setRefreshToken")),localStorage.setItem("psg_refresh_token",r),Promise.resolve()}setTokens(r){return this.noLocalStorage&&Promise.reject(this.noLocalStorageError("setTokens")),this.setAuthToken(r.auth_token),r.refresh_token&&this.setRefreshToken(r.refresh_token),Promise.resolve()}clearTokens(){return this.noLocalStorage&&Promise.reject(this.noLocalStorageError("clearTokens")),localStorage.removeItem("psg_auth_token"),document.cookie="psg_auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC;",localStorage.removeItem("psg_refresh_token"),Promise.resolve()}_isLocalHost(){return Boolean(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))}_isHttps(){return location.protocol==="https:"}};function b(t){return t.setTokens!==void 0}var $=t=>typeof t=="object"&&t!==null&&typeof t.auth_result<"u";function S(t,e){return $(t)?(b(e)&&e.setTokens(t.auth_result),t):(console.warn("Not a valid auth response"),t)}import{CreateCredentialUtils as z}from"@passageidentity/webauthnutils";var K=new y,O=class{constructor(e,r,o){this.tokenStore=r;this.apiUrl=e+"/register/",this.identifier=o}async withWebAuthn(e){var m;let r=await fetch(this.apiUrl+"webauthn/start",{headers:n(),body:JSON.stringify({identifier:this.identifier,authenticator_attachment:(m=e==null?void 0:e.authenticatorAttachment)!=null?m:T.Platform}),method:"POST"}).then(i),o=r.handshake.challenge.publicKey,{credential:s,transports:h}=await z.createCredential(o).catch(k=>{throw new u("error parsing public key for webAuthn",{status:g.PSGParsePublicKeyForLoginFailed,statusText:"PSG Parse Public Key For Login Failed"})}),a=new Uint8Array(s==null?void 0:s.response.attestationObject),P=r.user.id,_=await fetch(this.apiUrl+"webauthn/finish",{headers:n(),method:"POST",body:JSON.stringify({user_id:P,handshake_id:r.handshake.id,handshake_response:{rawId:c.encodeBytes(s==null?void 0:s.rawId),id:s==null?void 0:s.id,type:s==null?void 0:s.type,response:{attestationObject:c.encodeBytes(a),clientDataJSON:c.encodeBytes(s==null?void 0:s.response.clientDataJSON)},transports:h}})}).then(i).then(k=>S(k,this.tokenStore));return K.setPsgCredID(P,s),_.auth_result}};import{GetCredentialUtils as V}from"@passageidentity/webauthnutils";var C=class{constructor(e,r,o){this.tokenStore=r;this.apiUrl=e+"/login/",this.identifier=o!=null?o:""}async withWebAuthn(e){let r=JSON.stringify({identifier:this.identifier}),o=this.identifier?r:void 0,s=await fetch(this.apiUrl+"webauthn/start",{headers:n(),method:"POST",body:o}).then(i),h=s.handshake.challenge.publicKey,a=await V.getCredential(h,e).catch(_=>{throw new u("error parsing public key for webAuthn",{status:g.PSGParsePublicKeyForLoginFailed,statusText:"PSG Parse Public Key For Login Failed"})});return a?(await fetch(this.apiUrl+"webauthn/finish",{headers:n(),method:"POST",body:JSON.stringify({user_id:this.identifier?s.user.id:void 0,handshake_id:s.handshake.id,handshake_response:{id:a.id,rawId:c.encodeBytes(a.rawId),type:a.type,response:{clientDataJSON:c.encodeBytes(a.response.clientDataJSON),authenticatorData:c.encodeBytes(a.response.authenticatorData),signature:c.encodeBytes(a.response.signature),userHandle:c.encodeBytes(a.response.userHandle)}}})}).then(i).then(_=>S(_,this.tokenStore))).auth_result:{auth_token:"",redirect_url:""}}};var v=class{constructor(e){this.apiUrl=e}async appInfo(){return(await fetch(this.apiUrl,{headers:n(),method:"GET"}).then(i)).app}async identifierExists(e){return(await fetch(this.apiUrl+"/users?identifier="+encodeURIComponent(e),{headers:n(),method:"GET"}).then(i)).user}};var w=class{constructor(e,r){this.tokenStore=r;this.apiUrl=e}async newRegister(e,r){return(await fetch(this.apiUrl+"/register/magic-link",{headers:n(),method:"POST",body:JSON.stringify({identifier:e,magic_link_path:window.location.pathname+window.location.search+window.location.hash,language:r})}).then(i)).magic_link}async newLogin(e,r){return(await fetch(this.apiUrl+"/login/magic-link",{headers:n(),method:"POST",body:JSON.stringify({identifier:e,magic_link_path:window.location.pathname+window.location.search+window.location.hash,language:r})}).then(i)).magic_link}async getStatus(e){return(await fetch(this.apiUrl+"/magic-link/status",{headers:n(),method:"POST",body:JSON.stringify({id:e})}).then(i).then(o=>S(o,this.tokenStore))).auth_result}async activate(e){return(await fetch(this.apiUrl+"/magic-link/activate",{headers:n(),method:"PATCH",body:JSON.stringify({magic_link:e})}).then(i).then(o=>S(o,this.tokenStore))).auth_result}_parsePublicKeyLogin(e){if(e.challenge=c.decodeBytes(e.challenge.toString()),e.allowCredentials){for(let r=0;r<e.allowCredentials.length;r++){let o=e.allowCredentials[r];o.id=c.decodeBytes(o.id.toString())}return e}return e}_parsePublicKeyNewDevice(e){return e.challenge=c.decodeBytes(e.challenge.toString()),e.user.id=c.decodeBytes(e.user.id.toString()),e}};var R=class{constructor(e,r){this.tokenStore=r;this.apiUrl=e}async newRegister(e,r){return await fetch(this.apiUrl+"/register/otp",{headers:n(),method:"POST",body:JSON.stringify({identifier:e,language:r})}).then(i)}async newLogin(e,r){return await fetch(this.apiUrl+"/login/otp",{headers:n(),method:"POST",body:JSON.stringify({identifier:e,language:r})}).then(i)}async activate(e,r){return(await fetch(this.apiUrl+"/otp/activate",{headers:n(),method:"POST",body:JSON.stringify({otp:e,otp_id:r})}).then(i).then(s=>S(s,this.tokenStore))).auth_result}};var Y=(o=>(o.ACTIVE="active",o.INACTIVE="inactive",o.PENDING="pending",o))(Y||{}),H=(o=>(o.Platform="platform",o.Passkey="passkey",o.SecurityKey="security_key",o))(H||{});import M from"jwt-decode";import{Mutex as W}from"async-mutex";function E(t){return`${f.URL}/v1/apps/${t}`}var A=class{constructor(e,r){this.tokenStore=r;this.apiUrl=E(e)+"/tokens/"}async authGuard(){try{let e=await this.tokenStore.getAuthToken(),r=M(e,{header:!0}),o=M(e);return!!(o!==void 0&&r!==void 0&&this._validJWTPayload(o)&&this._validJWTHeader(r))}catch{return!1}}async signOut(){let e=await this.tokenStore.getRefreshToken();return e?fetch(`${this.apiUrl}?`+new URLSearchParams({refresh_token:e}),{method:"DELETE"}).then(({status:r})=>r===200).finally(()=>{b(this.tokenStore)&&this.tokenStore.clearTokens()}):(b(this.tokenStore)&&this.tokenStore.clearTokens(),!0)}async getAuthToken(){let e=await this._getMutex("getAuthToken").acquire(),r=await this.tokenStore.getAuthToken();if(await this.tokenStore.getRefreshToken()===void 0){if(!r)throw e(),new u("Login required",{status:g.PSGLoginRequired,statusText:"Login required"});return e(),r}if(r){let s=M(r);if(s!==void 0&&this._validJWTPayload(s))return e(),Promise.resolve(r)}return this.refresh().then(s=>s.auth_token).finally(()=>{e()})}async refresh(){let e=await this._getMutex("refresh").acquire(),r=new u("Login required",{status:g.PSGLoginRequired,statusText:"Login required"}),o=await this.tokenStore.getRefreshToken();return o?fetch(this.apiUrl,{headers:n(),method:"POST",body:JSON.stringify({refresh_token:o})}).then(i).then(s=>(b(this.tokenStore)&&this.tokenStore.setTokens(s.auth_result),s.auth_result)).catch(()=>{throw r}).finally(()=>{e()}):(e(),Promise.reject(r))}_validJWTPayload(e){let r=["exp","iss","sub"],o=Math.floor(Date.now()/1e3);return r.forEach(s=>{if(!(s in e))return!1}),!(e.exp&&o>e.exp)}_validJWTHeader(e){let r={alg:"RS256",typ:"JWT"};return!(e.alg!==r.alg||e.typ!==r.typ)}_getMutex(e){let r=globalThis;return(r.__PASSAGE__===void 0||r.__PASSAGE__.mutexes===void 0)&&(r.__PASSAGE__={mutexes:{}}),r.__PASSAGE__.mutexes[e]===void 0&&(r.__PASSAGE__.mutexes[e]=new W),r.__PASSAGE__.mutexes[e]}};var D=new y,I=class{constructor(e,r){this.tokenStore=r;this.apiUrl=E(e)+"/currentuser",this.session=new A(e,this.tokenStore)}async userInfo(){let e=await this._getToken(),r=await fetch(this.apiUrl,{method:"GET",headers:n({Authorization:`Bearer ${e}`})}).then(async o=>o.status!==200?void 0:await o.json()).catch(o=>{throw new u("Failed to fetch current user.",{status:g.NotFound,statusText:"Not Found"})});return r==null?void 0:r.user}async changeEmail(e,r){let o=await this._getToken();return(await fetch(`${this.apiUrl}/email`,{method:"PATCH",headers:n({Authorization:`Bearer ${o}`,"Content-Type":"application/json"}),body:JSON.stringify({new_email:e,language:r})}).then(i)).magic_link}async changePhone(e,r){let o=await this._getToken();return(await fetch(`${this.apiUrl}/phone`,{method:"PATCH",headers:n({Authorization:`Bearer ${o}`,"Content-Type":"application/json"}),body:JSON.stringify({new_phone:e,language:r})}).then(i)).magic_link}async editDevice(e,r){if(e===""||e===void 0)throw new u("A deviceID is required for an edit device request.",{status:g.BadRequest,statusText:"Bad Request"});if(Object.keys(r).length===0)throw new u("Edit device request must not have an empty request body.",{status:g.BadRequest,statusText:"Bad Request"});let o=await this._getToken();return(await fetch(`${this.apiUrl}/devices/${e}`,{method:"PATCH",headers:n({Authorization:`Bearer ${o}`,"Content-Type":"application/json"}),body:JSON.stringify({...r})}).then(i)).device}async listDevices(){let e=await this._getToken();return(await fetch(`${this.apiUrl}/devices/`,{method:"GET",headers:n({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})}).then(i)).devices}async addDevice(e){var _;let r=await this._getToken(),o=await fetch(this.apiUrl+"/devices/start",{headers:n({Authorization:`Bearer ${r}`}),body:JSON.stringify({authenticator_attachment:(_=e==null?void 0:e.authenticatorAttachment)!=null?_:T.Platform}),method:"POST"}).then(i),s=await navigator.credentials.create({publicKey:this._parsePublicKey(o.handshake.challenge.publicKey)}).catch(m=>{throw new u("failed to parse public key",{status:g.PSGParsePublicKeyForNewDeviceFailed,statusText:"PSG Parse Public Key For New Device Failed"})}).then(m=>m),h=[];(s==null?void 0:s.response.getTransports)&&typeof(s==null?void 0:s.response.getTransports)=="function"&&(h=s==null?void 0:s.response.getTransports());let a=o.user.id,P=await fetch(this.apiUrl+"/devices/finish",{headers:n({Authorization:`Bearer ${r}`}),method:"POST",body:JSON.stringify({user_id:a,handshake_id:o.handshake.id,handshake_response:{rawId:c.encodeBytes(s==null?void 0:s.rawId),id:s==null?void 0:s.id,type:s==null?void 0:s.type,response:{attestationObject:c.encodeBytes(s==null?void 0:s.response.attestationObject),clientDataJSON:c.encodeBytes(s==null?void 0:s.response.clientDataJSON)},transports:h}})}).then(i);return D.setPsgCredID(a,s),P.device}async deleteDevice(e){let r=typeof e=="string"?e:e.id,o=typeof e=="string"?void 0:e.cred_id;if(!r)throw new u("A deviceID is required to delete a device.",{status:g.NotFound,statusText:"Not Found"});let s=!1,h=await this._getToken();return s=await fetch(`${this.apiUrl}/devices/${r}`,{method:"DELETE",headers:n({Authorization:`Bearer ${h}`,"Content-Type":"application/json"})}).then(async a=>a.ok?!0:await a.text().then(P=>{throw new u(P,a)})),s&&o!==void 0&&D.removeCredential(o),s}async listSocialConnections(){let e=await this._getToken();return(await fetch(`${this.apiUrl}/social-connections/`,{method:"GET",headers:n({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})}).then(i)).social_connections}async deleteSocialConnection(e){let r=!1,o=await this._getToken();return r=await fetch(`${this.apiUrl}/social-connections/${e}`,{method:"DELETE",headers:n({Authorization:`Bearer ${o}`,"Content-Type":"application/json"})}).then(async s=>s.ok?!0:await s.text().then(h=>{throw new u(h,s)})),r}async getMetadata(){let e=await this._getToken();return(await fetch(`${this.apiUrl}/user-metadata`,{method:"GET",headers:n({Authorization:`Bearer ${e}`})}).then(i)).user_metadata}async updateMetadata(e){let r=await this._getToken();return(await fetch(`${this.apiUrl}/user-metadata`,{method:"PATCH",headers:n({Authorization:`Bearer ${r}`,"Content-Type":"application/json"}),body:JSON.stringify({user_metadata:e})}).then(i)).user}_parsePublicKey(e){return e.challenge=c.decodeBytes(e.challenge.toString()),e.user.id=c.decodeBytes(e.user.id.toString()),e}async _getToken(){return await this.session.getAuthToken()}};import{GetCredentialUtils as Q}from"@passageidentity/webauthnutils";var U=class{async getBrowserInfo(){let e=await Q.getCredentialAvailable();return{createPassKeySupported:e.syncedCredential,getPassKeySupported:e.syncedCredential,conditionalUISupported:e.conditionalUI}}};var x=class{constructor(e,r){this.tokenStore=r;this.apiUrl=e+"/social"}async authorizeWith(e){if(!window.isSecureContext)throw new u("Passage Social Login requires a secure context (HTTPS or localhost)",{status:g.PSGSecureContextRequired,statusText:"Secure context required"});sessionStorage.setItem("oauth2Connection",e);let r=await this._getQueryParams(e);window.location.href=`${this.apiUrl}/authorize?${r}`}async exchangeToken(e){let r=sessionStorage.getItem("oauth2Verifier");if(r===null||r===""||r===" ")throw new u("Social login verifier not found",{status:g.PSGSocialSessionStorageError,statusText:"Social login verifier not found"});let o=`${this.apiUrl}/token?code=${e}&verifier=${r}`;return(await fetch(o,{headers:n(),method:"GET"}).then(i).then(h=>S(h,this.tokenStore))).auth_result}async _getQueryParams(e){let r=window.location.href,o=this._getRandomString(32);sessionStorage.setItem("oauth2State",o);let s=await this._getCodeChallenge(),a={redirect_uri:r,state:o,code_challenge:s,code_challenge_method:"S256",connection_type:e};return new URLSearchParams(a).toString()}async _getCodeChallenge(){let e=this._getRandomString(32);return sessionStorage.setItem("oauth2Verifier",e),await this._sha256Hash(e)}_getRandomString(e){return window.crypto.getRandomValues(new Uint8Array(e)).toString().replace(/,/g,"")}async _sha256Hash(e){let o=new TextEncoder().encode(e),s=await window.crypto.subtle.digest("SHA-256",o);return c.encodeBytes(s)}};var F=class{constructor(e,r){this.appID=e;this.fullUrl=E(this.appID),(r==null?void 0:r.tokenStore)===void 0?this.tokenStore=new N:this.tokenStore=r.tokenStore,this.extraHeaders=r==null?void 0:r.extraHeaders,f.EXTRA_HEADERS=this.extraHeaders}credIDExists(e){let r=new y().getPsgCredObj();return r?!!JSON.parse(r)[e]:!1}async register(e,r){return await new O(this.fullUrl,this.tokenStore,e).withWebAuthn(r)}async login(e){return await new C(this.fullUrl,this.tokenStore,e).withWebAuthn()}async loginConditional(e){return await new C(this.fullUrl,this.tokenStore).withWebAuthn({mediation:"conditional",signal:e})}async appInfo(){return await new v(this.fullUrl).appInfo()}async browserInfo(){return await new U().getBrowserInfo()}async getCredentialAvailable(){return await X.getCredentialAvailable()}async createCredentialAvailable(){return await J.createCredentialAvailable()}checkWebauthnConfig(e){let r=!0;return e.auth_origin.replace(/\/$/,"")!=window.location.origin.replace(/\/$/,"")&&(console.error('The auth_origin configured for webauthn in your app settings does not match the "origin" of your current URL.  Please reconfigure this in the admin console. (Your current "origin" is `'+window.location.origin+"`) Passage will continue to work with other authentication methods."),r=!1),r}async isWebauthnSupported(e){let r=await J.createCredentialAvailable();return e?r.securityKey:r.platform}async identifierExists(e){let o=await new v(this.fullUrl).identifierExists(e);return o&&(o.hasPasskey=o.webauthn_types.includes("passkey"),o)}async newRegisterMagicLink(e,r){return await new w(this.fullUrl,this.tokenStore).newRegister(e,r)}async newLoginMagicLink(e,r){return await new w(this.fullUrl,this.tokenStore).newLogin(e,r)}async magicLinkActivate(e){return await new w(this.fullUrl,this.tokenStore).activate(e)}async getMagicLinkStatus(e){return await new w(this.fullUrl,this.tokenStore).getStatus(e)}async newRegisterOneTimePasscode(e,r){return await new R(this.fullUrl,this.tokenStore).newRegister(e,r)}async newLoginOneTimePasscode(e,r){return await new R(this.fullUrl,this.tokenStore).newLogin(e,r)}async oneTimePasscodeActivate(e,r){return await new R(this.fullUrl,this.tokenStore).activate(e,r)}getCurrentUser(){return new I(this.appID,this.tokenStore)}getCurrentSession(){return new A(this.appID,this.tokenStore)}async createUser(e){return(await fetch(`${this.fullUrl}/users`,{headers:n(),body:JSON.stringify({...e}),method:"POST"}).then(i)).user}async authorizeWith(e){await new x(this.fullUrl,this.tokenStore).authorizeWith(e)}async finishSocialAuthentication(e){return await new x(this.fullUrl,this.tokenStore).exchangeToken(e)}};import{serializeError as Z}from"serialize-error";var ee=t=>JSON.parse(JSON.stringify(t,(e,r)=>{if(!(r==null||r==="undefined"))return r})),Vt=async t=>{try{let{error:e,message:r,sentryConfig:{url:o=f.CAPTURE_EVENT_URL,project:s=f.SENTRY_PROJECT,dsn:h=f.SENTRY_PROJECT_DSN,environment:a=f.SENTRY_PROJECT_ENV,release:P=f.SENTRY_RELEASE,version:_=f.SENTRY_PROJECT_VERSION}={}}=t,m=ee({project:s,dsn:h,environment:a,url:o,release:P,version:_});if(!(m.project&&m.url)||!(e||r))return;let k={project:m.project,dsn:m.dsn,environment:m.environment,release:m.release,version:m.version};r&&(k={...k,message:r}),e&&(k={...k,serializedError:Z(typeof e=="string"?new Error(e):e)}),await fetch(m.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(k)})}catch(e){console.error(e)}};var te=(o=>(o.email="email",o.phone="phone",o.both="both",o))(te||{}),re=(s=>(s.Phone="phone",s.Email="email",s.Both="both",s.Either="either",s))(re||{}),oe=(a=>(a.STRING="string",a.BOOLEAN="boolean",a.INTEGER="integer",a.DATE="date",a.PHONE="phone",a.EMAIL="email",a))(oe||{}),se=(o=>(o.LoginCode="otp",o.MagicLink="magic_link",o.None="none",o))(se||{}),ne=(o=>(o.Google="google",o.Github="github",o.Apple="apple",o))(ne||{}),ie=(p=>(p.ANDALE_MONO="Andal\xE9 Mono",p.ARIAL="Arial",p.ARIAL_BLACK="Arial Black",p.BASKERVILLE="Baskerville",p.BRADLEY_HAND="Bradley Hand",p.BRUSH_SCRIPT_MT="Brush Script MT",p.COMIC_SANS_MS="Comic Sans MS",p.COURIER="Courier",p.GEORGIA="Georgia",p.GILL_SANS="Gill Sans",p.HELVETICA="Helvetica",p.IMPACT="Impact",p.LUCIDA="Lucida",p.LUMINARI="Luminari",p.MONACO="Monaco",p.PALATINO="Palatino",p.TAHOMA="Tahoma",p.TIMES_NEW_ROMAN="Times New Roman",p.TREBUCHET_MS="Trebuchet MS",p.VERDANA="Verdana",p))(ie||{}),ae=(s=>(s.Seconds="s",s.Minutes="m",s.Hours="h",s.Days="d",s))(ae||{});export{se as AllowedFallbackAuth,T as AuthenticatorAttachment,ae as DisplayUnit,te as Identifier,F as Passage,u as PassageError,g as PassageErrorCode,N as PassageTokenStore,Y as PassageUserStatus,B as ReadOnlyTokenStore,re as RequiredIdentifier,A as Session,ne as SocialConnection,G as TokenStore,I as User,oe as UserMetadataType,H as WebAuthnType,ie as WebSafeFonts,Vt as captureEvent,ee as cleanSentryConfig,b as isFullTokenStore};
//#