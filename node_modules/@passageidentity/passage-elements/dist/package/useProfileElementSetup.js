"use strict";var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,r=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&i(e,a,t[a]);if(n)for(var a of n(t))o.call(t,a)&&i(e,a,t[a]);return e},s=(e,t,a)=>new Promise(((n,l)=>{var o=e=>{try{r(a.next(e))}catch(t){l(t)}},i=e=>{try{r(a.throw(e))}catch(t){l(t)}},r=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,i);r((a=a.apply(e,t)).next())})),c=require("./customElements.js");const u=c.defineComponent({name:"Modal",props:{active:{type:Boolean,default:!1},title:{type:String,default:""},onPrimaryButton:{type:Function,required:!1},onCancelButton:{type:Function,required:!1},primaryButtonText:{type:String,default:"OK"},cancelButtonText:{type:String,default:"Cancel"},info:{type:Boolean,default:!1},cancelOnly:{type:Boolean,default:!1},danger:{type:Boolean,default:!1},centerTitle:{type:Boolean,default:!1}},setup(e,t){const a=c.ref(!1);c.watchEffect((()=>{a.value=e.active,a.value?document.documentElement.classList.add("is-clipped"):document.documentElement.classList.remove("is-clipped")}));return c.onUnmounted((()=>document.documentElement.classList.remove("is-clipped"))),{isActive:a,closeModal:()=>{a.value=!1},primaryAction:function(){void 0!==e.onPrimaryButton?e.onPrimaryButton().then((e=>{e&&t.emit("update:active",!1)})):t.emit("update:active",!1)},cancelAction:function(){void 0!==e.onCancelButton?e.onCancelButton().then((()=>{t.emit("update:active",!1)})):t.emit("update:active",!1)}}}}),d=c.createBaseVNode("div",{class:"passage-modal-background"},null,-1),v={class:"passage-modal-card"},p={key:0,class:"passage-modal-footer"};var m=c._export_sfc(u,[["render",function(e,t,a,n,l,o){return c.openBlock(),c.createBlock(c.Transition,{name:"modal",mode:"out-in"},{default:c.withCtx((()=>[e.isActive?(c.openBlock(),c.createElementBlock("div",{key:0,class:c.normalizeClass(["passage-modal",{"is-active":e.isActive}]),part:"modal",role:"dialog",onKeyup:[t[2]||(t[2]=c.withKeys(((...t)=>e.primaryAction&&e.primaryAction(...t)),["enter"])),t[3]||(t[3]=c.withKeys(((...t)=>e.cancelAction&&e.cancelAction(...t)),["esc"]))]},[d,c.createBaseVNode("div",v,[c.createBaseVNode("div",{class:c.normalizeClass(["title secondary-title",{"danger-header":e.danger,"has-text-centered":e.centerTitle}])},c.toDisplayString(e.title),3),c.createBaseVNode("div",{class:c.normalizeClass(["passage-modal-body",{centered:e.centerTitle}])},[c.renderSlot(e.$slots,"default")],2),e.info&&e.cancelOnly?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("div",p,[e.cancelOnly?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("button",{key:0,class:"button is-modal",part:"modal-button modal-primary",onClick:t[0]||(t[0]=c.withModifiers(((...t)=>e.primaryAction&&e.primaryAction(...t)),["prevent"])),"data-testid":"primary-modal-button"},c.toDisplayString(e.primaryButtonText),1)),e.info?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("button",{key:1,class:c.normalizeClass(["button is-secondary is-modal cancel-button",{"cancel-only":e.cancelOnly}]),part:"modal-button modal-secondary",onClick:t[1]||(t[1]=c.withModifiers(((...t)=>e.cancelAction&&e.cancelAction(...t)),["prevent"])),"data-testid":"secondary-modal-button"},c.toDisplayString(e.cancelButtonText),3))]))])],34)):c.createCommentVNode("",!0)])),_:3})}]]);const f={class:"has-text-centered"},y={key:1,style:{"margin-bottom":"16px"},class:"text is-danger has-text-centered"},g={key:2},k={style:{"margin-bottom":"12px"}},B={style:{"margin-bottom":"22px"}},h={key:3,class:"flex-row flex-center"},b=["disabled"],C=["disabled"],N={key:4,class:"flex-row flex-center"},D=["disabled"],V={class:"link has-text-centered",style:{"margin-top":"32px"}},w=c.defineComponent({__name:"AddDevice",props:{active:{type:Boolean},passkeyFeatures:{}},emits:["dialogClose","update:active"],setup(e,{emit:t}){const a=e,n=t,{t:l}=c.useLocale(),o=c.computed({get:()=>a.active,set(e){n("update:active",e)}}),i=c.computed((()=>{var e,t;return null!=(t=null==(e=a.passkeyFeatures)?void 0:e.platform)&&t})),r=c.computed((()=>{var e,t;return null!=(t=null==(e=a.passkeyFeatures)?void 0:e.securityKey)&&t})),{addDevice:u,addPending:d,errorMessage:v}=c.useAddDevice(),p=c.ref();let w=c.T.Platform;function x(e){return s(this,null,(function*(){return w=e,p.value=yield u(e),!!p.value&&(o.value=!1,n("dialogClose"),!0)}))}function I(){!0===i.value?x(c.T.Platform):x(c.T.CrossPlatform)}function _(){x(c.T.CrossPlatform)}function S(){x(w)}function E(){v.value="",o.value=!1}return(e,t)=>{const a=c.resolveComponent("loading");return c.openBlock(),c.createBlock(m,{title:c.unref(l)("add-passkey"),active:o.value,"onUpdate:active":t[0]||(t[0]=e=>o.value=e),"cancel-only":"",info:"","center-title":""},{default:c.withCtx((()=>[c.unref(d)?(c.openBlock(),c.createBlock(a,{key:0,active:c.unref(d)},null,8,["active"])):c.createCommentVNode("",!0),c.createBaseVNode("figure",f,[c.unref(v)?(c.openBlock(),c.createBlock(c.unref(c.InlineSvg),{key:0,style:{"margin-top":"24px"},src:c.unref(c.Icons).fingerprintFailed,alt:"Biometrics scan failed"},null,8,["src"])):(c.openBlock(),c.createBlock(c.unref(c.InlineSvg),{key:1,src:c.unref(c.Icons).passkey,alt:"Register with a passkey"},null,8,["src"]))]),c.unref(v)?(c.openBlock(),c.createElementBlock("div",y,c.toDisplayString(c.unref(v)),1)):c.createCommentVNode("",!0),c.unref(v)?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("div",g,[c.createBaseVNode("div",k,c.toDisplayString(c.unref(l)("passkeys-are-a-simple")),1),c.createBaseVNode("div",B,c.toDisplayString(c.unref(l)("passkey-register-options")),1)])),c.unref(v)?(c.openBlock(),c.createElementBlock("div",N,[c.createBaseVNode("button",{onClick:c.withModifiers(S,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:c.unref(d),style:{"margin-right":"5px",width:"auto"},"data-testid":"add-device-primary-button"},c.toDisplayString(c.unref(l)("try-again")),9,D)])):(c.openBlock(),c.createElementBlock("div",h,[c.createBaseVNode("button",{onClick:c.withModifiers(I,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:c.unref(d),style:{"margin-right":"5px",width:"auto"},"data-testid":"add-device-primary-button"},c.toDisplayString(i.value?c.unref(l)("continue"):c.unref(l)("use-another-device")),9,b),i.value&&r.value?(c.openBlock(),c.createElementBlock("button",{key:0,onClick:c.withModifiers(_,["prevent"]),type:"button",part:"button button-secondary",class:"button is-secondary",disabled:c.unref(d),style:{"margin-left":"5px"},"data-testid":"add-device-secondary-button"},c.toDisplayString(c.unref(l)("use-another-device")),9,C)):c.createCommentVNode("",!0)])),c.createBaseVNode("div",V,[c.createBaseVNode("a",{onClick:c.withModifiers(E,["prevent"]),role:"button","data-testid":"add-device-skip"},c.toDisplayString(c.unref(l)("cancel")),1)])])),_:1},8,["title","active"])}}}),x={class:"profile-table-icon-wrapper"},I=c.defineComponent({__name:"DeviceIcon",props:{device:{}},setup(e){const t=e,{theme:a}=c.useTheme(),n=e=>e===c.H.SecurityKey?c.Icons.securityKey:c.Icons.passkey,l=c.computed((()=>{var e,l;if(!t.device.icons)return n(t.device.type);switch(a.value){case c.Theme.Dark:return null!=(e=t.device.icons.dark)?e:n(t.device.type);case c.Theme.Light:return null!=(l=t.device.icons.light)?l:n(t.device.type);default:return n(t.device.type)}}));return(e,t)=>(c.openBlock(),c.createElementBlock("div",x,[""===l.value?(c.openBlock(),c.createBlock(c.unref(c.InlineSvg),{key:0,class:"profile-table-icon",src:c.unref(c.Icons).passkey,alt:"Device icon",fill:"currentColor"},null,8,["src"])):(c.openBlock(),c.createBlock(c.unref(c.InlineSvg),{key:1,class:"profile-table-icon",src:l.value,alt:"Device icon",fill:"currentColor"},null,8,["src"]))]))}});const _={class:"device-name"},S=["readonly","data-testid"],E={class:"message is-danger"},M={class:"text is-danger"},T=c.defineComponent({__name:"DeviceName",props:{device:{},selectedDeviceId:{},isEditing:{type:Boolean},index:{}},emits:["finish-editing"],setup(e,{emit:t}){const a=e,n=c.ref(""),l=c.ref(a.device.friendly_name),o=c.ref(),i=c.computed((()=>a.isEditing&&a.device.id===a.selectedDeviceId)),{t:r}=c.useLocale(),{renameDevice:u,editPending:d,errorMessage:v}=function(){const{t:e}=c.useLocale(),{passage:t}=c.usePassage(),a=t.getCurrentUser(),n=c.ref(!1),l=c.ref("");return{renameDevice:function(t,o){return s(this,null,(function*(){n.value=!0;try{return yield a.editDevice(t,{friendly_name:o}),!0}catch(i){return l.value=e("failed-to-rename-this-device"),!1}finally{n.value=!1}}))},editPending:n,errorMessage:l}}(),p=t;function m(){n.value="",v.value=""}function f(){return s(this,null,(function*(){return!!(yield function(e,t){return s(this,null,(function*(){if(!a.device)return p("finish-editing",!1),!1;if(v.value)return p("finish-editing",!1),m(),!0;if(!e)return n.value=r("device-name-is-required"),!1;if(e.length>64)return n.value=r("device-name-maximum"),!1;if(e===t)return p("finish-editing",!1),!0;const l=yield u(a.device.id,e);return l?(p("finish-editing",!1),!0):l}))}(l.value,a.device.friendly_name))}))}return c.watch(i,(e=>{e&&a.device.id===a.selectedDeviceId&&setTimeout((()=>{var e;null==(e=null==o?void 0:o.value)||e.focus()}))})),(e,t)=>{const a=c.resolveComponent("loading");return c.openBlock(),c.createElementBlock(c.Fragment,null,[c.unref(d)?(c.openBlock(),c.createBlock(a,{key:0,active:c.unref(d)},null,8,["active"])):c.createCommentVNode("",!0),c.createBaseVNode("div",_,[c.createBaseVNode("div",null,[c.withDirectives(c.createBaseVNode("input",{ref_key:"deviceNameInputRef",ref:o,type:"text",class:c.normalizeClass(["input short",{readonly:!i.value}]),part:"input","onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),onInput:m,onBlur:f,onKeyup:c.withKeys(f,["enter"]),readonly:!i.value,tabindex:"0","data-testid":`passkey-table-row-${e.index}-device-name`},null,42,S),[[c.vModelText,l.value]]),c.createBaseVNode("div",E,c.toDisplayString(n.value),1),c.createBaseVNode("div",M,c.toDisplayString(c.unref(v)),1)])])],64)}}}),A=c.defineComponent({name:"Loading",props:{active:Boolean},setup:(e,{attrs:n})=>()=>e.active?c.h(c.Transition,{name:"fade",mode:"out-in"},(()=>{return[c.h("div",(e=r({},n),l={class:["component-loading loading-overlay is-overlay"],title:"Loading..."},t(e,a(l))),[c.h("div",{class:["loading-background is-overlay"]},""),c.h("div",{class:["loading-icon"]})])];var e,l})):null});function L(){const{t:e}=c.useLocale(),{passage:t}=c.usePassage(),a=t.getCurrentUser(),n=c.ref(!1),l=c.ref("");return{revokeDevice:function(t){return s(this,null,(function*(){n.value=!0;try{return yield a.deleteDevice(t),!0}catch(o){return l.value=e("failed-to-revoke-this-device"),!1}finally{n.value=!1}}))},revokeSocialConnection:function(t){return s(this,null,(function*(){n.value=!0;try{return yield a.deleteSocialConnection(t),!0}catch(o){return l.value=e("failed-to-revoke-this-social-connection"),!1}finally{n.value=!1}}))},revokePending:n,errorMessage:l}}const P={key:0,class:"passage-table-paginator"},z={class:"page-size-selector"},F={style:{"margin-right":"15px"}},$={class:"paginator-text"},O={class:"paginator-buttons flex-row"},U=["onClick"],R=c.defineComponent({__name:"Paginator",props:{dataset:{},page:{}},emits:["update:page"],setup(e,{emit:t}){const a=e,n=t,{t:l}=c.useLocale(),o=c.ref(5),i=[{name:"5",value:5},{name:"10",value:10},{name:"15",value:15}],r=c.computed((()=>s.value.length>1||void 0!==a.dataset&&a.dataset.length>5)),s=c.computed((()=>{if(void 0===a.dataset||0===a.dataset.length)return[];const e=[];for(let t=0;t<a.dataset.length;t+=o.value){const n=a.dataset.slice(t,t+o.value);e.push(n)}return d.value=e[0],v.value=0,e})),u=c.ref([]),d=c.computed({get:()=>u.value,set(e){u.value=e,n("update:page",e)}}),v=c.ref(0),p=c.computed({get:()=>v.value,set(e){v.value=e,s.value&&(d.value=s.value[e])}}),m=c.computed((()=>{var e,t;const n=p.value,i=o.value,r=null!=(t=null==(e=a.dataset)?void 0:e.length)?t:0,s=n*i+1,c=Math.min(n*i+i,r);return l("showing-page-of-n",[s,c,r])})),f=(e,t,a)=>Array.from({length:(t-e)/a+1},((t,n)=>e+n*a)),y=c.computed((()=>{if(s.value.length<3)return f(0,s.value.length-1,1);if(0===p.value)return f(0,2,1);const e=s.value.length;return p.value===e-1?f(e-3,e-1,1):f(p.value-1,p.value+1,1)}));function g(){p.value=0}function k(){0!==p.value&&(p.value-=1)}function B(){p.value!==s.value.length-1&&(p.value+=1)}function h(){p.value!==s.value.length-1&&(p.value=s.value.length-1)}return(e,t)=>r.value?(c.openBlock(),c.createElementBlock("div",P,[c.createBaseVNode("div",z,[c.createBaseVNode("span",F,c.toDisplayString(c.unref(l)("rows-per-page")),1),c.createVNode(c.Dropdown,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),items:i},null,8,["modelValue"])]),c.createBaseVNode("div",$,c.toDisplayString(m.value),1),c.createBaseVNode("div",O,[c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:0===p.value}]),part:"paginator-button",onClick:c.withModifiers(g,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).doubleChevronLeft,alt:"First page"},null,8,["src"])],2),c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:0===p.value}]),part:"paginator-button",onClick:c.withModifiers(k,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).chevronLeft,alt:"Previous page"},null,8,["src"])],2),(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(y.value,(e=>(c.openBlock(),c.createElementBlock("div",{key:e,class:c.normalizeClass(["paginator-button",{selected:e===p.value}]),part:"paginator-button",onClick:c.withModifiers((t=>{return a=e,void(p.value=a);var a}),["prevent"])},c.toDisplayString(e+1),11,U)))),128)),c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:p.value===s.value.length-1}]),part:"paginator-button",onClick:c.withModifiers(B,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).chevronRight,alt:"Next page"},null,8,["src"])],2),c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:p.value===s.value.length-1}]),part:"paginator-button",onClick:c.withModifiers(h,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).doubleChevronRight,alt:"Last page"},null,8,["src"])],2)])])):c.createCommentVNode("",!0)}});var j=(e=>(e.default="DEFAULT",e.danger="DANGER",e))(j||{});const K={class:"action-menu"},q=["onMousedown","data-testid"],Y=c.defineComponent({__name:"DropdownActionMenu",props:{actions:{}},setup(e){const t=c.ref(!1);function a(e){t.value=void 0===e?!t.value:e}return(e,n)=>(c.openBlock(),c.createElementBlock("div",K,[c.createBaseVNode("div",{class:"menu-icon",onClick:n[0]||(n[0]=c.withModifiers((e=>a()),["prevent"])),onFocusout:n[1]||(n[1]=c.withModifiers((e=>a(!1)),["prevent"])),tabindex:"0","data-testid":"action-menu-button"},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).ellipsis,alt:"Action menu"},null,8,["src"])],32),c.createBaseVNode("div",{class:c.normalizeClass(["menu-dropdown",{collapsed:!t.value}])},[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(e.actions,(e=>(c.openBlock(),c.createElementBlock("div",{class:c.normalizeClass(["menu-item",{danger:e.type===c.unref(j).danger}]),key:e.displayName,onMousedown:t=>e.action(),"data-testid":e.testID},c.toDisplayString(e.displayName),43,q)))),128))],2)]))}}),W={class:"device-actions"},G={key:0},H=["data-testid"],J=["onClick","data-testid"],Q=c.defineComponent({__name:"IconActionMenu",props:{actions:{},index:{}},setup(e){const t=c.ref(),a=c.ref(""),n=c.ref(!1),l=c.ref(""),o=c.ref((()=>s(this,null,(function*(){return!1}))));function i(){n.value=!1}return c.watch(n,(e=>{e&&setTimeout((()=>{var e;null==(e=null==t?void 0:t.value)||e.focus()}))})),(e,r)=>(c.openBlock(),c.createElementBlock("div",W,[n.value?(c.openBlock(),c.createElementBlock("div",G,[c.createBaseVNode("button",{ref_key:"confirmationButtonRef",ref:t,class:"button is-primary",part:"button","data-testid":`${a.value}-confirmation`,onClick:r[0]||(r[0]=c.withModifiers(((...e)=>o.value&&o.value(...e)),["prevent"])),onBlur:i},c.toDisplayString(l.value),41,H)])):(c.openBlock(!0),c.createElementBlock(c.Fragment,{key:1},c.renderList(e.actions,(t=>{var i;return c.openBlock(),c.createElementBlock("div",{class:c.normalizeClass(["menu-item",{danger:t.type===c.unref(j).danger}]),key:t.displayName,onClick:e=>function(e){return s(this,null,(function*(){return e.requiresConfirmation?(n.value=!0,l.value=e.confirmationText,a.value=e.testID,o.value=e.action,!1):(yield e.action(),!0)}))}(t),"data-testid":`${t.testID}-${e.index}`},[c.createBaseVNode("div",{class:c.normalizeClass(["device-actions-icon-wrapper",t.testID]),tabindex:"0"},[c.createVNode(c.unref(c.InlineSvg),{class:"device-actions-icon",src:null!=(i=t.icon)?i:"",alt:t.testID},null,8,["src","alt"])],2)],10,J)})),128))]))}}),X={class:"passage-table",part:"passage-table"},Z={key:0,class:"passage-table-header-row",part:"passage-table-header-row"},ee=c.createBaseVNode("th",{class:"passage-table-header-cell passage-action-menu-cell",part:"passage-table-header-cell"},null,-1),te=["data-testid"],ae=["data-testid"],ne={key:2,class:"passage-table-empty"},le=["colspan"],oe={class:"title secondary-title","data-testid":"empty-table"},ie=c.defineComponent({__name:"SimpleDataTable",props:{dataset:{},headers:{},columns:{},isIconActionMenu:{type:Boolean},actions:{}},setup(e){const t=e,a=c.ref(),{t:n}=c.useLocale(),l=c.ref(),o=new ResizeObserver((()=>{s()})),i=c.ref(!1),r=c.ref(0);function s(){if(void 0===l.value)return;const e=l.value.getBoundingClientRect().width;i.value=e<500}function u(){if(void 0!==t.dataset)if(null!==l.value&&void 0!==l.value){if(t.dataset.length>5){const e=l.value.getBoundingClientRect().height;r.value=Math.ceil(e)}}else r.value=0;else r.value=0}function d(e){var a;return void 0===t.actions?[]:null==(a=t.actions)?void 0:a.map((t=>{var a,n,l,o;return{displayName:t.displayName,testID:t.testID,type:t.type,action:()=>{t.action(e)},icon:null!=(a=t.icon)?a:void 0,alt:null!=(n=t.alt)?n:void 0,requiresConfirmation:null!=(l=t.requiresConfirmation)&&l,confirmationText:null!=(o=t.confirmationText)?o:""}}))}function v(e){return c.dayjs(e).format("MMMM D, YYYY")}return c.watch((()=>t.dataset),(()=>{u(),s(),l.value&&o.observe(l.value)})),c.onMounted((()=>{u(),s(),l.value&&o.observe(l.value)})),c.onUnmounted((()=>{o.disconnect()})),(e,t)=>(c.openBlock(),c.createElementBlock("div",{style:c.normalizeStyle(`min-height: ${r.value}px`),ref_key:"tableContainer",ref:l},[c.createBaseVNode("table",X,[c.createBaseVNode("tbody",null,[e.headers?(c.openBlock(),c.createElementBlock("tr",Z,[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(i.value?[e.headers[0]]:e.headers,(e=>(c.openBlock(),c.createElementBlock("th",{key:e,class:"passage-table-header-cell",part:"passage-table-header-cell"},c.toDisplayString(e),1)))),128)),ee])):c.createCommentVNode("",!0),a.value?(c.openBlock(!0),c.createElementBlock(c.Fragment,{key:1},c.renderList(a.value,((t,a)=>(c.openBlock(),c.createElementBlock("tr",{key:a,class:"passage-table-row",part:"passage-table-row","data-testid":`passkey-table-row-${a}`},[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(i.value?[e.columns[0]]:e.columns,((n,l)=>(c.openBlock(),c.createElementBlock("td",{key:n,class:c.normalizeClass(["passage-table-cell",{isMobile:i.value}]),part:"passage-table-cell","data-testid":`passkey-table-cell-${l}`},[c.renderSlot(e.$slots,n,{value:t[n],item:t,index:a,isMobile:i.value,formatDateTime:v},(()=>[c.createTextVNode(c.toDisplayString(t[n]),1)]))],10,ae)))),128)),e.actions&&e.actions.length>0?(c.openBlock(),c.createElementBlock("td",{key:0,class:c.normalizeClass(["passage-table-cell passage-action-menu-cell",{isIconMenu:e.isIconActionMenu,isMobile:i.value}]),part:"passage-table-cell"},[e.isIconActionMenu?(c.openBlock(),c.createBlock(Q,{key:0,actions:d(t),index:a},null,8,["actions","index"])):(c.openBlock(),c.createBlock(Y,{key:1,actions:d(t)},null,8,["actions"]))],2)):c.createCommentVNode("",!0)],8,te)))),128)):(c.openBlock(),c.createElementBlock("tr",ne,[c.createBaseVNode("td",{class:"passage-table-empty-cell",colspan:i.value?3:e.columns.length+1},[c.createBaseVNode("div",oe,c.toDisplayString(c.unref(n)("no-devices-found")),1),c.createBaseVNode("div",null,c.toDisplayString(c.unref(n)("there-are-no-devices-registered")),1)],8,le)]))])]),c.createVNode(R,{dataset:e.dataset,page:a.value,"onUpdate:page":t[0]||(t[0]=e=>a.value=e)},null,8,["dataset","page"])],4))}}),re={class:"table-container"},se={class:"flex-row flex-end",style:{"margin-bottom":"30px"}},ce={class:"title secondary-title"},ue=c.createBaseVNode("div",{class:"spacer"},null,-1),de={class:"flex-row",style:{"align-items":"center"}},ve={class:"profile-table-info"},pe={key:0,class:"text is-danger"},me={class:"profile-table-metadata"},fe=["data-testid"],ye=["data-testid"],ge={key:0,class:"current-device"},ke=c.defineComponent({__name:"DevicesTable",props:{userInfo:{},refreshDevices:{type:Function},webauthnAllowed:{type:Boolean}},setup(e){const t=e,{t:a}=c.useLocale(),{passage:n}=c.usePassage(),{revokeDevice:l,errorMessage:o}=L(),i=c.ref(),r=c.ref(!1),u=c.ref(!1);n.createCredentialAvailable().then((e=>{i.value=e}));const d=c.computed((()=>{if(void 0===t.userInfo)return[];return t.userInfo.webauthn_devices.map((e=>e)).sort(((e,t)=>new Date(e.last_login_at)>new Date(t.last_login_at)?-1:1))})),v=c.ref();function p(e){v.value=e,u.value=!0}function m(e){return s(this,null,(function*(){if(v.value=e,o.value)return!0;const t=yield l(e);return t&&k(),t}))}const f=c.computed((()=>[{displayName:a("edit-device"),type:j.default,action:p,icon:c.Icons.pencil,alt:"Edit passkey name",testID:"edit-passkey-button",requiresConfirmation:!1},{displayName:a("revoke-device"),type:j.danger,action:m,icon:c.Icons.close,alt:"Delete passkey",testID:"revoke-passkey-button",requiresConfirmation:!0,confirmationText:a("delete")}])),y=c.computed((()=>{var e,a;if(void 0===t.userInfo)return;const n=localStorage.getItem("psg_cred_obj");if(!n)return;const l=JSON.parse(n)[null!=(a=null==(e=t.userInfo)?void 0:e.id)?a:""];return t.userInfo.webauthn_devices.find((e=>e.cred_id===l))})),g=c.ref(!1);function k(){return s(this,null,(function*(){v.value=void 0,g.value=!0,yield t.refreshDevices(),g.value=!1}))}return(e,t)=>(c.openBlock(),c.createElementBlock("div",re,[g.value?(c.openBlock(),c.createBlock(A,{key:0,active:g.value},null,8,["active"])):c.createCommentVNode("",!0),c.createBaseVNode("div",se,[c.createBaseVNode("div",ce,c.toDisplayString(c.unref(a)("my-passkeys")),1),ue,e.userInfo&&e.webauthnAllowed?(c.openBlock(),c.createElementBlock("button",{key:0,part:"button button-secondary",class:"button is-secondary is-modal",onClick:t[0]||(t[0]=c.withModifiers((e=>r.value=!0),["prevent"])),"data-testid":"add-passkey-button"},c.toDisplayString(c.unref(a)("add-device")),1)):c.createCommentVNode("",!0)]),(c.openBlock(),c.createBlock(ie,{class:"passage-profile-table",dataset:d.value,columns:["friendly_name"],actions:f.value,isIconActionMenu:!0,key:d.value.length},{friendly_name:c.withCtx((({item:e,index:n,isMobile:l,formatDateTime:i})=>{var r,s;return[c.createBaseVNode("div",de,[l?c.createCommentVNode("",!0):(c.openBlock(),c.createBlock(I,{key:0,device:e},null,8,["device"])),c.createBaseVNode("div",{class:c.normalizeClass(["profile-table-content",{isMobile:l}])},[c.createBaseVNode("div",ve,[c.createVNode(T,{device:e,selectedDeviceId:null==(r=v.value)?void 0:r.id,isEditing:u.value,onFinishEditing:t[1]||(t[1]=e=>u.value=!1),index:n},null,8,["device","selectedDeviceId","isEditing","index"]),c.unref(o)?(c.openBlock(),c.createElementBlock("div",pe,c.toDisplayString(c.unref(o)),1)):c.createCommentVNode("",!0),c.createBaseVNode("div",me,[c.createBaseVNode("span",{"data-testid":`passkey-table-row-${n}-device-date-added`},c.toDisplayString(`${c.unref(a)("added-time")}: ${i(e.created_at)}`),9,fe),c.createBaseVNode("span",{"data-testid":`passkey-table-row-${n}-device-last-login`},c.toDisplayString(`${c.unref(a)("last-login")}: ${i(e.last_login_at)}`),9,ye)])]),(null==(s=y.value)?void 0:s.id)===e.id?(c.openBlock(),c.createElementBlock("div",ge,c.toDisplayString(c.unref(a)("current")),1)):c.createCommentVNode("",!0)],2)])]})),_:1},8,["dataset","actions"])),c.createVNode(w,{active:r.value,"onUpdate:active":t[2]||(t[2]=e=>r.value=e),onDialogClose:k,"passkey-features":i.value},null,8,["active","passkey-features"])]))}});exports.ActionType=j,exports._sfc_main=A,exports._sfc_main$1=ie,exports._sfc_main$2=ke,exports.useCurrentUser=function(e){const t=c.ref(!0),a=c.ref(void 0),n=c.ref(void 0),{passage:l}=c.usePassage(),o=l.getCurrentUser();function i(){void 0!==e&&e.user_metadata_schema.forEach((e=>{if(!n.value||!n.value.user_metadata)return;const t=n.value.user_metadata[e.field_name];e.type===c.oe.DATE&&t&&(n.value.user_metadata[e.field_name]=c.dayjs(t).format("MM/DD/YYYY"))}))}return c.onMounted((()=>{!function(){s(this,null,(function*(){try{t.value=!0,o&&(n.value=yield o.userInfo(),void 0!==n.value&&null===n.value.user_metadata&&(n.value.user_metadata={}),i())}catch(e){a.value=e}finally{t.value=!1}}))}()})),{userInfo:n,loading:t,error:a,refreshDevices:function(){return s(this,null,(function*(){if(n.value)try{n.value.webauthn_devices=yield o.listDevices()}catch(e){a.value=e}finally{t.value=!1}}))},refreshSocialConnections:function(){return s(this,null,(function*(){if(n.value)try{n.value.social_connections=yield o.listSocialConnections()}catch(e){a.value=e}finally{t.value=!1}}))},refreshMetadata:function(){return s(this,null,(function*(){var e;if(n.value)try{n.value.user_metadata=null!=(e=yield o.getMetadata())?e:{},i()}catch(l){a.value=l}finally{t.value=!1}}))}}},exports.useProfileElementSetup=function(e){function t(){const{updateDefaultCountryCode:t}=c.useDefaultCountryCode();t(e.defaultCountryCode),e.appId&&c.createPassageInstance(e.appId,e.tokenStore)}t(),c.onBeforeUpdate((()=>{t()}));const{languageLoading:a}=c.useStoreLocale(e),{currentTheme:n}=c.useThemeSetup(e),l=c.ref();return c.useIntlTelInput(l),{languageLoading:a,containerRef:l,currentTheme:n}},exports.useRevokeAuthMethod=L,exports.useSetupWebauthn=function(e,t){const a=c.ref(!1),n=c.ref(!1),l=c.ref(!1);return c.watch(e,(()=>s(this,null,(function*(){if(l.value=!1,void 0!==e.value&&void 0!==t.value){if(n.value=void 0!==e.value.auth_methods.passkeys,n.value){t.value.checkWebauthnConfig(e.value)&&(a.value=(yield t.value.createCredentialAvailable()).securityKey)}l.value=!0}})))),{webauthnAllowed:a,passkeysEnabled:n,initialized:l}};
//# 
