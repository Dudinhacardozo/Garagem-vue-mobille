"use strict";var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,l=(e,t,n)=>new Promise(((a,o)=>{var i=e=>{try{l(n.next(e))}catch(t){o(t)}},r=e=>{try{l(n.throw(e))}catch(t){o(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((n=n.apply(e,t)).next())})),s=require("./customElements.js"),c=require("./socialConnectionMetadata.js");function u(e){return null==e||""===e||" "===e}var d=(e=>(e.phone="PHONE",e.email="EMAIL",e))(d||{});function p(){const e=s.ref();return s.watch(e,(()=>{void 0!==e.value&&null!==e.value&&e.value.focus()})),{autofocusButton:e}}const f={class:"identifier-form"},v={class:"has-text-centered"},m=(e=>(s.pushScopeId("data-v-a9054ff0"),e=e(),s.popScopeId(),e))((()=>s.createBaseVNode("br",null,null,-1))),g={class:"identifier-text"},y=["autocomplete","inputmode","placeholder"],h={class:"flex-row flex-center"},k={key:0,style:{"margin-top":"30px"},class:"link has-text-centered"},b=s.defineComponent({__name:"ValidatedIdentifierForm",props:{validationError:{default:""},identifier:{},countryCode:{},identifierMode:{},showWelcomeBack:{type:Boolean,default:!1},conditionalUI:{type:Boolean,default:!1}},emits:["onSubmit","update:validationError","update:identifier","update:countryCode","update:showWelcomeBack"],setup(e,{emit:t}){const n=e,a=t,{t:o}=s.useLocale(),i=s.ref(""),r=s.ref(),b=s.ref(),{autofocusButton:B}=p(),{passage:V}=s.usePassage(),w=s.computed((()=>n.showWelcomeBack)),I=s.computed((()=>{let e;switch(n.identifierMode){case s.te.phone:e=o("phone-number");break;case s.te.email:e=o("email-address");break;case s.te.both:e=o("email-or-phone-number")}return e.charAt(0).toUpperCase()+e.slice(1)})),N=s.computed((()=>"example@email.com")),_=s.computed((()=>n.identifierMode===s.te.phone?"tel":"email")),C=s.computed((()=>{var e;return n.conditionalUI?`${_.value} webauthn`:null!=(e=_.value)?e:""})),S=s.computed({get:()=>n.identifier,set(e){a("update:identifier",e)}});function x(){var e;if(!S.value)return"";let t=S.value;return w.value||(t=M()?null!=(e=null==A?void 0:A.getNumber())?e:"":S.value),t.trim().toLowerCase()}const E=s.computed((()=>u(n.validationError)?u(i.value)?"":i.value:n.validationError));function D(){i.value="",a("update:validationError","")}function T(){return l(this,null,(function*(){if(!function(){if(""===x()){let e="";switch(n.identifierMode){case s.te.phone:e=o("enter-a-phone-number");break;case s.te.email:e=o("enter-an-email-address");break;case s.te.both:e=o("enter-an-email-or-phone-number")}return i.value=e,!1}if(n.identifierMode===s.te.email&&!L())return i.value=o("enter-a-valid-email-address"),!1;if(n.identifierMode===s.te.phone&&!M())return i.value=o("enter-a-valid-phone-number"),!1;if(n.identifierMode===s.te.both&&!M()&&!L())return i.value=o("enter-a-valid-email-or-phone-number"),!1;return!0}())return;let e,t,r,l=!1,c=[],u="";try{const n=yield V.identifierExists(x());null!==n?(e=!0,r=n.status,u=n.id,t=n.email_verified,l=n.phone_verified,c=n.webauthn_types):(e=!1,r=s.Y.INACTIVE)}catch(p){let e;switch(n.identifierMode){case s.te.email:e=o("enter-a-valid-email-address");break;case s.te.phone:e=o("enter-a-valid-phone-number");break;case s.te.both:e=o("enter-a-valid-email-or-phone-number")}return void(i.value=e)}a("onSubmit",{identifier:x(),identifierExists:e,identifierType:M()?d.phone:d.email,userStatus:r,userID:u,emailVerified:t,phoneVerified:l,webauthnTypes:c})}))}function L(){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(x())}function M(){return w.value?U():void 0!==A&&A.isValidNumber()}let A;function R(){void 0===A&&(r.value.addEventListener("countrychange",(()=>{var e;a("update:countryCode",null!=(e=null==A?void 0:A.getSelectedCountryData().iso2)?e:"")})),A=c.intlTelInput(r.value,{initialCountry:n.countryCode,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",dropdownContainer:b.value,autoPlaceholder:"aggressive"}),r.value.focus())}function U(){return/^\+$|^\+?[0-9,(,),\-, ]+$/.test(S.value.trim())}s.onMounted((()=>{n.conditionalUI&&function(){const e=F.value.getRootNode().host;void 0!==e&&(F.value.appendChild(function(){const e=document.createElement("style");return e.appendChild(document.createTextNode("\n      .psg-input{\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        box-sizing: border-box;\n        color: var(--passage-input-text-color, var(--passage-body-text-color-default));\n        font-family: var(--passage-body-font-family, var(--passage-body-font-family-default));\n        font-size: var(--passage-body-font-size, var(--passage-body-font-size-default));\n        font-weight: var(--passage-body-font-weight, var(--passage-body-font-weight-default));\n\n        min-height: 40px;\n        width: 100%;\n\n        padding-left: 10px;\n        padding-right: 10px;\n        margin: 0;\n\n        background-color: var(--passage-input-box-background-color, var(--passage-input-box-background-color-default));\n        border-style: solid;\n        border-color: var(--passage-control-border-color, var(--passage-control-border-color-default));\n        border-width: 1px;\n        border-radius: var(--passage-input-box-border-radius, var(--passage-input-box-border-radius-default));\n\n        transition: all 0.3s;\n\n        text-overflow: ellipsis;\n      }\n\n      .psg-input:hover {\n        border-color: var(--passage-control-border-hover-color, var(--passage-control-border-hover-color-default));\n      }\n\n      .psg-input:focus{\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }\n\n      .psg-input:active{\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }\n\n      .psg-input.has-error{\n        border-color: var(--passage-error-color, var(--passage-error-color-default));\n      }\n      .psg-input.is-danger{\n        border-color: var(--passage-error-color, var(--passage-error-color-default));\n      }\n      .iti {\n        width: 100%;\n      }\n\n        .iti__country-list {\n            border-radius: 6px;\n        }\n\n        .iti__country {\n            padding: 5px 10px;\n        }\n\n        .iti__selected-flag {\n            border-top-left-radius: var(--passage-control-border-radius, var(--passage-input-box-border-radius-default));\n            border-bottom-left-radius: var(--passage-control-border-radius, var(--passage-input-box-border-radius-default));\n        }\n\n    .iti--container {\n        top: unset !important;\n        left: unset !important;\n    }")),e}()),F.value.appendChild(function(){const e=document.createElement("link");return e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.16/css/intlTelInput.css",e}()),e.appendChild(F.value))}(),n.identifierMode===s.te.phone&&R()})),n.identifierMode===s.te.both&&s.watch(S,(()=>{U()?R():void 0!==A&&(A.destroy(),A=void 0,r.value&&r.value.focus())}));const P=s.computed((()=>n.countryCode));function O(){a("update:showWelcomeBack",!1),S.value=""}s.watch(P,(e=>{null==A||A.setCountry(e)}));const F=s.ref();return s.onBeforeUnmount((()=>{F.value.remove()})),(e,t)=>(s.openBlock(),s.createElementBlock("div",f,[s.withDirectives(s.createBaseVNode("div",v,[s.createTextVNode(s.toDisplayString(s.unref(o)("welcome-back-sign-in-as")),1),m,s.createBaseVNode("strong",g,s.toDisplayString(S.value),1)],512),[[s.vShow,e.showWelcomeBack]]),s.withDirectives(s.createBaseVNode("div",null,[s.createBaseVNode("div",{class:"label",ref:"labelRef"},s.toDisplayString(I.value),513),s.createBaseVNode("form",{ref_key:"identifierForm",ref:F,slot:"loginInput",onSubmit:s.withModifiers(T,["prevent"])},[s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e),type:"text",class:s.normalizeClass(["input psg-input",{"is-danger":E.value}]),part:"input",autocomplete:C.value,inputmode:_.value,id:"identifier",placeholder:N.value,onInput:s.withModifiers(D,["prevent"]),"data-testid":"identifier-input",ref_key:"identifierInput",ref:r},null,42,y),[[s.vModelText,S.value]])],544),s.renderSlot(e.$slots,"loginInput",{},void 0,!0)],512),[[s.vShow,!e.showWelcomeBack]]),s.createBaseVNode("div",{ref_key:"controlContainer",ref:b,style:{width:"100%"}},null,512),s.createBaseVNode("div",{style:s.normalizeStyle([`text-align: ${w.value?"center":"left"};`,{height:"32px"}]),class:"help is-danger error-message","data-testid":"validation-error"},s.toDisplayString(E.value),5),s.renderSlot(e.$slots,"metadataFields",{},void 0,!0),s.createBaseVNode("div",h,[s.createBaseVNode("button",{class:"button is-primary",part:"button","data-testid":"continue-button",ref_key:"autofocusButton",ref:B,onClick:s.withModifiers(T,["prevent"])},s.toDisplayString(s.unref(o)("continue")),513)]),w.value?(s.openBlock(),s.createElementBlock("div",k,[s.createBaseVNode("a",{onClick:s.withModifiers(O,["prevent"]),role:"button",class:"body-link","data-testid":"register-link"},s.toDisplayString(s.unref(o)("switch-account")),1)])):s.createCommentVNode("",!0)]))}});var B=s._export_sfc(b,[["__scopeId","data-v-a9054ff0"]]),V=(e=>(e.onLoaded="onLoaded",e.onRegisterDevice="onRegisterDevice",e.onVerifyIdentity="onVerifyIdentity",e.onMagicLinkLogin="onMagicLinkLogin",e.onMagicLinkRegister="onMagicLinkRegister",e.onMagicLinkActivated="onMagicLinkActivated",e.onMagicLinkActivateSuccess="onMagicLinkActivateSuccess",e.onOneTimePasscodeLogin="onOneTimePasscodeLogin",e.onOneTimePasscodeRegister="onOneTimePasscodeRegister",e.onOneTimePasscodeActivated="onOneTimePasscodeActivated",e.onOneTimePasscodeActivateSuccess="onOneTimePasscodeActivateSuccess",e))(V||{}),w=(e=>(e.Login="login",e.Register="register",e))(w||{});const I=()=>!0,N=e=>{window.location.href=e.redirect_url},_=()=>{},C=s.ref(I),S=s.ref(N),x=s.ref(_);function E(e){C.value=void 0!==e?e:I}function D(e){S.value=void 0!==e?e:N}function T(e){x.value=void 0!==e?e:_}function L(){return{beforeAuth:s.readonly(C),onSuccess:s.readonly(S),onEvent:s.readonly(x),setBeforeAuth:E,setOnSuccess:D,setOnEvent:T}}function M(e){const{appInfo:t,router:n,passkeyFeatures:a}=e;!function(){const e=new URLSearchParams(window.location.search);e.delete("code"),e.delete("link_account"),e.delete("provider_identifier"),e.delete("state");let t=window.location.pathname;0!==e.size&&(t+=`?${e.toString()}`);window.history.pushState({},document.title,t)}(),n.push(n.homeRoute,{appInfo:t,conditionalUI:a.conditionalUI,changeEmail:!0})}var A=(e=>(e.Email="email",e.SMS="sms",e.None="none",e))(A||{});function R(e){return e.auth_methods.otp?"sms":e.auth_methods.magic_link?"email":"none"}function U(e,t,n){return l(this,null,(function*(){var a,o;t.authState.linkingAccount=null!=(a=e.linkingAccount)&&a,t.authState.socialLogin=null!=(o=e.linkingAccount)&&o;const{passkeyFeatures:i,appInfo:r,router:l}=t,{emitEvent:c}=W(),{identifier:u,identifierType:p,webauthnTypes:f,emailVerified:v,phoneVerified:m,userID:g}=e,y=R(r)===A.None;if(0===f.length&&y)return void l.push(Ta);const h=f.includes(s.H.Passkey),k=f.includes(s.H.Platform),b=f.includes(s.H.SecurityKey),B=function(e,t,n,a){if(e.require_identifier_verification&&(a===d.email&&!t||a===d.phone&&!n))return!0;return!1}(r,v,m,p),w=i.platform&&k&&n.credIDExists(g),I=(i.syncedCredential||i.crossDeviceCredential)&&h,N=i.securityKey&&b,_=i.platform&&y,C=h&&i.platform&&!navigator.credentials.get.toString().includes("[native code]");!B&&(I||w||N||_||C)?(L().onEvent.value(V.onVerifyIdentity),l.push(Ca,{identifier:u,identifierType:p,appInfo:r,userIsVerifying:e.linkingAccount})):c({type:F.EmailOrSMSAuth,payload:{identifier:u,identifierType:p,userInitiated:!1,identifierVerifying:B||e.linkingAccount,setupNewDevice:i.platform}})}))}function P(e,t){const{authState:n,appInfo:a,router:o}=t;switch(n.userInitiatedFallback=e.userInitiated,R(a)){case A.SMS:!function(e){const{identifier:t,userIsRegistering:n}=e;n?L().onEvent.value(V.onOneTimePasscodeRegister,{identifier:t}):L().onEvent.value(V.onOneTimePasscodeLogin)}(e),o.push(xa,e);break;case A.Email:!function(e){const{identifier:t,userIsRegistering:n}=e;n?L().onEvent.value(V.onMagicLinkRegister,{identifier:t}):L().onEvent.value(V.onMagicLinkLogin)}(e),o.push(_a,e);break;case A.None:o.push(Da)}}function O(e,t,n){return l(this,null,(function*(){if(u(e.authResult.auth_token)||u(e.authResult.redirect_url))return;const{socialLogin:a,linkingAccount:o}=t.authState;o&&(yield function(e){return l(this,null,(function*(){const t=window.location.search,n=new URLSearchParams(t).get("code");null!==n&&""!==n&&" "!==n?yield e.getCurrentUser().linkSocialAccount(n):console.error("Failed to link social account to existing account")}))}(n)),a||(yield function(e,t,n){return l(this,null,(function*(){if(n&&"string"==typeof n)return void localStorage.setItem("psg_last_login",n);let a=n;if(void 0===n)try{a=yield t.getCurrentUser().userInfo()}catch(i){console.error("Failed to fetch current user, auth token likely missing or invalid",i)}if(void 0===a)return;let o="";switch(e.allowed_identifier){case s.te.email:o=a.email;break;case s.te.phone:o=a.phone;break;case s.te.both:o=a.email?a.email:a.phone}localStorage.setItem("psg_last_login",o)}))}(t.appInfo,n,e.identifier)),L().onSuccess.value(e.authResult)}))}var F=(e=>(e.CreatedUser="CreatedUser",e.ChangeIdentifier="ChangeIdentifier",e.LoginUser="LoginUser",e.EmailOrSMSAuth="EmailOrSMSAuth",e.AuthSuccess="AuthSuccess",e.EmailOrSMSAuthSuccess="EmailOrSMSAuthSuccess",e.SocialAuthEvent="SocialAuthEvent",e))(F||{});class j{constructor(e,t,n){this.appInfo=e,this.router=t,this.passage=n,this.authState={userInitiatedFallback:!1,socialLogin:!1,linkingAccount:!1},this.authOriginValid=!1,this.passkeyFeatures={securityKey:!1,platform:!1,syncedCredential:!1,crossDeviceCredential:!1,conditionalUI:!1,isAvailable:!1}}initializeEventHandler(){return l(this,null,(function*(){void 0!==this.appInfo.auth_methods.passkeys&&(this.authOriginValid=this.passage.checkWebauthnConfig(this.appInfo),this.authOriginValid&&(this.passkeyFeatures=yield this.passage.getCredentialAvailable(),function(){var e;const t=new s.UAParser;return(null==(e=t.getBrowser().name)?void 0:e.toLowerCase().includes("safari"))&&parseFloat(t.getBrowser().version||"")<16.4}()&&(this.passkeyFeatures.conditionalUI=!1)));const e=this.checkMagicLink(),t=this.checkSocialLogin();e||t||this.router.push(this.router.homeRoute,{appInfo:this.appInfo,conditionalUI:this.passkeyFeatures.conditionalUI})}))}handleEvent(e){return l(this,null,(function*(){switch(e.type){case"CreatedUser":!function(e,t){const{appInfo:n,router:a,passkeyFeatures:o}=t,{identifier:i,identifierType:r}=e,{emitEvent:l}=W();o.securityKey&&!n.require_identifier_verification?(L().onEvent.value(V.onRegisterDevice,{identifier:i}),a.push(Na,{identifier:i,identifierType:r,appInfo:n,passkeyFeatures:o})):l({type:F.EmailOrSMSAuth,payload:{identifier:i,identifierType:r,identifierVerifying:n.require_identifier_verification,userIsRegistering:!0,userInitiated:!1}})}(e.payload,this.eventHandlerState);break;case"ChangeIdentifier":M(this.eventHandlerState);break;case"LoginUser":U(e.payload,this.eventHandlerState,this.passage);break;case"EmailOrSMSAuth":P(e.payload,this.eventHandlerState);break;case"AuthSuccess":O(e.payload,this.eventHandlerState,this.passage);break;case"EmailOrSMSAuthSuccess":!function(e,t){const{webauthnAllowed:n,authState:a,router:o}=t;!n||a.userInitiatedFallback||a.linkingAccount?W().emitEvent({type:F.AuthSuccess,payload:e}):o.push(Ea,e)}(e.payload,this.eventHandlerState);break;case"SocialAuthEvent":!function(e,t){l(this,null,(function*(){const{emitEvent:n}=W(),a=window.location.search,o=new URLSearchParams(a),i=o.get("code"),r=o.get("link_account"),l=o.get("provider_identifier");if(null!==i&&null!==r&&null!==l)if(e.authState.socialLogin=!0,"true"!==r)try{const e=yield t.finishSocialAuthentication(i);n({type:F.AuthSuccess,payload:{authResult:e}})}catch(s){const e=s;console.error("Exchanging social token for Passage token failed:",e.message),n({type:F.ChangeIdentifier,payload:void 0})}else e.router.push(La,{identifier:l,code:i});else n({type:F.ChangeIdentifier,payload:void 0})}))}(this.eventHandlerState,this.passage)}}))}get eventHandlerState(){return{appInfo:this.appInfo,webauthnAllowed:this.passkeyFeatures.platform,router:this.router,authState:this.authState,passkeyFeatures:this.passkeyFeatures}}checkMagicLink(){const e=window.location.search,t=new URLSearchParams(e);let n=null;return t.has("psg_magic_link")?n=t.get("psg_magic_link"):t.has("psg_verify_link")&&(n=t.get("psg_verify_link")),null!==n&&(this.router.push(Sa,{magicLink:n,webauthnAllowed:this.passkeyFeatures.platform}),!0)}checkSocialLogin(){const e=window.location.search,t=new URLSearchParams(e);return!!(t.has("code")&&t.has("state")&&t.has("link_account")&&t.has("provider_identifier"))&&(this.handleEvent({type:"SocialAuthEvent",payload:void 0}),!0)}}let $;function z(e,t,n){return l(this,null,(function*(){$=new j(e,t,n),yield $.initializeEventHandler()}))}function H(){return $}function G(e){return l(this,null,(function*(){return null==$?void 0:$.handleEvent(e)}))}function W(){return{initEventHandler:z,getEventHandler:H,emitEvent:G}}const K=s.defineComponent({__name:"Login",props:{canToggleLoginRegister:{type:Boolean},identifier:{},countryCode:{},appInfo:{},visible:{type:Boolean},conditionalUI:{type:Boolean},changeEmail:{type:Boolean}},emits:["update:identifier","update:countryCode"],setup(e,{emit:t}){const n=e,a=t,{t:o}=s.useLocale(),{passage:i}=s.usePassage(),r=s.ref(""),c=s.computed((()=>Object.keys(n.appInfo.auth_methods).length>0)),u=s.computed({get:()=>n.identifier,set(e){a("update:identifier",e)}}),p=s.computed({get:()=>n.countryCode,set(e){a("update:countryCode",e)}}),f=s.ref();s.watch(f,(()=>l(this,null,(function*(){L().onEvent.value(V.onLoaded),h()}))));const v=s.computed((()=>{var e;return null!=(e=n.appInfo.allowed_identifier)?e:s.te.email}));function m(e){return l(this,null,(function*(){const{identifier:t,identifierExists:a,userStatus:i,userID:l,identifierType:c,emailVerified:u,phoneVerified:p,webauthnTypes:f}=e;if(!L().beforeAuth.value(t,{authType:w.Login}))return;const v=function(e,t,a){if(!e){let e=t===d.email?o("email"):o("phone");e=`${e.charAt(0).toUpperCase()}${e.slice(1)}`;let a=`${o("not-recognized",[e])}.`;return n.canToggleLoginRegister&&n.appInfo.public_signup&&(a=`${a} ${o("toggle-register")}`),a}if(e&&a===s.Y.INACTIVE)return o("account-no-longer-active");return""}(a,c,i);""===v?W().emitEvent({type:F.LoginUser,payload:{identifier:t,identifierType:c,userID:l,emailVerified:u,phoneVerified:p,webauthnTypes:f}}):r.value=v}))}const g=s.ref(!1);let y;function h(){return l(this,null,(function*(){n.conditionalUI&&(y=new AbortController,i.loginConditional(y.signal).then((e=>{W().emitEvent({type:F.AuthSuccess,payload:{authResult:e}})})).catch((()=>{})))}))}function k(){null==y||y.abort()}return s.onMounted((()=>{const e=localStorage.getItem("psg_last_login");e&&!n.changeEmail&&(u.value=e,g.value=!0)})),s.onBeforeUnmount((()=>{k()})),s.watch((()=>n.visible),(()=>{!0===g.value&&(u.value=""),g.value=!1,n.visible?h():k()})),(e,t)=>c.value?(s.openBlock(),s.createBlock(B,{key:0,identifierMode:v.value,conditionalUI:e.conditionalUI,showWelcomeBack:g.value,"onUpdate:showWelcomeBack":t[0]||(t[0]=e=>g.value=e),identifier:u.value,"onUpdate:identifier":t[1]||(t[1]=e=>u.value=e),validationError:r.value,"onUpdate:validationError":t[2]||(t[2]=e=>r.value=e),countryCode:p.value,"onUpdate:countryCode":t[3]||(t[3]=e=>p.value=e),onOnSubmit:t[4]||(t[4]=e=>m(e)),ref_key:"inputForm",ref:f},{loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},8,["identifierMode","conditionalUI","showWelcomeBack","identifier","validationError","countryCode"])):s.createCommentVNode("",!0)}}),q={key:0},Y={key:0,class:"notification is-danger has-text-centered","data-testid":"invalid-app-id"},Z=s.defineComponent({__name:"Register",props:{canToggleLoginRegister:{type:Boolean},identifier:{},countryCode:{},appInfo:{}},emits:["update:identifier","update:countryCode","authEvent"],setup(e,{emit:t}){const n=e,a=t,{t:o}=s.useLocale(),{passage:i}=s.usePassage(),{emitEvent:r}=W(),u=s.ref(""),p=s.ref({}),f=s.ref(),v=s.computed((()=>Object.keys(n.appInfo.auth_methods).length>0)),m=s.computed({get:()=>n.identifier,set(e){a("update:identifier",e)}}),g=s.computed({get:()=>n.countryCode,set(e){a("update:countryCode",e)}}),y=s.computed((()=>n.appInfo.public_signup)),h=s.computed((()=>n.appInfo.allowed_identifier));return(e,t)=>v.value?(s.openBlock(),s.createElementBlock("div",q,[s.createVNode(B,{identifierMode:h.value,identifier:m.value,"onUpdate:identifier":t[0]||(t[0]=e=>m.value=e),validationError:u.value,"onUpdate:validationError":t[1]||(t[1]=e=>u.value=e),countryCode:g.value,"onUpdate:countryCode":t[2]||(t[2]=e=>g.value=e),onOnSubmit:t[3]||(t[3]=e=>function(e){return l(this,null,(function*(){const{identifier:t,identifierExists:a,userStatus:l,identifierType:v}=e;let m,g=!0;if(f.value&&(g=f.value.validate()),a){if(l===s.Y.ACTIVE){let e=o("account-already-exists",[v===d.email?o("email"):o("phone-number")]);return n.canToggleLoginRegister&&(e=e+" "+o("toggle-login")),void(u.value=e)}if(l===s.Y.INACTIVE)return void(u.value=o("account-no-longer-active"))}if(g&&(f.value&&(m=c.transformMetadata(p.value,n.appInfo.user_metadata_schema,!0)),L().beforeAuth.value(t,{userMetadata:m,authType:w.Register}))){try{yield i.createUser({identifier:t,user_metadata:m})}catch(y){return void(y instanceof s.u&&y.message.startsWith("Public signup")?u.value=y.message:u.value=o("unexpected-error"))}r({type:F.CreatedUser,payload:{identifier:t,identifierType:v}})}}))}(e))},{metadataFields:s.withCtx((()=>[e.appInfo&&e.appInfo.layouts.registration.length>0?(s.openBlock(),s.createBlock(c.UserMetadata,{key:0,isEditing:!0,appInfo:e.appInfo,layoutType:s.unref(c.LayoutType).Registration,userMetadata:p.value,ref_key:"metadataComponent",ref:f},null,8,["appInfo","layoutType","userMetadata"])):s.createCommentVNode("",!0)])),_:1},8,["identifierMode","identifier","validationError","countryCode"]),y.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",Y,s.toDisplayString(s.unref(o)("public-registration-not-allowed")),1))])):s.createCommentVNode("",!0)}}),J={key:0,class:"link has-text-centered"},Q={class:"passage-branding"},X={href:"https://passage.1password.com/",target:"_new_tab"},ee=s.defineComponent({__name:"PassageBranding",props:{appInfo:{}},setup:e=>(e,t)=>e.appInfo.passage_branding?(s.openBlock(),s.createElementBlock("div",J,[s.createBaseVNode("div",Q,[s.createBaseVNode("a",X,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).poweredByPassage,alt:"Powered by Passage Icon"},null,8,["src"])])])])):s.createCommentVNode("",!0)}),te=["data-testid"],ne=s.defineComponent({__name:"SocialAuthButton",props:{connection:{}},setup(e){const{t:t}=s.useLocale(),{theme:n}=s.useTheme(),{passage:a}=s.usePassage(),o=e,i=s.computed((()=>{switch(n.value){case s.Theme.Dark:return c.socialConnectionMetadata[o.connection].icons.dark;case s.Theme.Light:default:return c.socialConnectionMetadata[o.connection].icons.light}})),r=s.computed((()=>t("continue-with-social",[t(c.socialConnectionMetadata[o.connection].nameKey)]))),u=s.computed((()=>`${t(c.socialConnectionMetadata[o.connection].nameKey)} icon`));function d(){return l(this,null,(function*(){try{a.authorizeWith(o.connection)}catch(e){const t=e;t.statusCode===s.g.PSGSecureContextRequired?console.error(t.message):console.error("An unkown error occured while attempting to login with a social account.")}}))}return(e,t)=>(s.openBlock(),s.createElementBlock("button",{class:"button is-social",onClick:s.withModifiers(d,["prevent"]),"data-testid":`social-auth-button-${e.connection}`},[s.createVNode(s.unref(s.InlineSvg),{class:"social-button-icon",src:i.value,alt:u.value},null,8,["src","alt"]),s.createBaseVNode("span",null,s.toDisplayString(r.value),1)],8,te))}}),ae={key:0,class:"social-button-spacer"},oe=s.defineComponent({__name:"SocialAuthButtonList",props:{appInfo:{}},setup(e){const t=e,n=s.computed((()=>Object.keys(t.appInfo.social_connections).filter((e=>Object.keys(c.socialConnectionMetadata).includes(e)))));return(e,t)=>(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(n.value,((e,t)=>(s.openBlock(),s.createElementBlock("div",{class:"flex-column flex-center",key:e},[s.createVNode(ne,{connection:e},null,8,["connection"]),t!==n.value.length-1?(s.openBlock(),s.createElementBlock("div",ae)):s.createCommentVNode("",!0)])))),128))}}),ie={key:0,class:"spacer-tall"},re={key:1,class:"social-login-divider"},le=s.createBaseVNode("hr",{class:"divider-line"},null,-1),se={class:"divider-text","data-testid":"social-auth-divider"},ce=s.createBaseVNode("hr",{class:"divider-line"},null,-1),ue={key:2,class:"spacer-tall"},de=s.defineComponent({__name:"SocialAuth",props:{appInfo:{}},setup(e){const t=e,{t:n}=s.useLocale(),a=s.computed((()=>Object.keys(t.appInfo.social_connections))),o=s.computed((()=>{const e=Object.keys(t.appInfo.auth_methods).length>0,n=a.value.length>0;return e&&n}));return(e,t)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[o.value?(s.openBlock(),s.createElementBlock("div",ie)):s.createCommentVNode("",!0),o.value?(s.openBlock(),s.createElementBlock("div",re,[le,s.createBaseVNode("span",se,s.toDisplayString(s.unref(n)("or")),1),ce])):s.createCommentVNode("",!0),o.value?(s.openBlock(),s.createElementBlock("div",ue)):s.createCommentVNode("",!0),s.createVNode(oe,{"app-info":e.appInfo},null,8,["app-info"])],64))}}),pe={class:"view-email-input auth-flex-container"},fe={class:"auth-flex-container"},ve={class:"title main-title has-text-centered"},me=s.createBaseVNode("div",{style:{height:"20px"}},null,-1),ge=s.createBaseVNode("div",{class:"spacer-tall"},null,-1),ye={class:"link has-text-centered"},he={key:0},ke={key:1},be=s.defineComponent({__name:"AuthView",props:{register:{type:Boolean},appInfo:{},conditionalUI:{type:Boolean},changeEmail:{type:Boolean}},setup(e){const{t:t}=s.useLocale(),n=e,a=s.ref(!n.register),o=s.ref(""),{defaultCountryCode:i}=s.useDefaultCountryCode(),r=i,l=s.computed((()=>n.appInfo.public_signup));function c(){a.value=!a.value}return(e,n)=>(s.openBlock(),s.createElementBlock("div",pe,[s.createBaseVNode("div",fe,[s.createBaseVNode("div",ve,s.toDisplayString(a.value?s.unref(t)("login-title"):s.unref(t)("register-title")),1),me,s.withDirectives(s.createVNode(K,{identifier:o.value,"onUpdate:identifier":n[0]||(n[0]=e=>o.value=e),canToggleLoginRegister:!0,countryCode:s.unref(r),"onUpdate:countryCode":n[1]||(n[1]=e=>s.isRef(r)?r.value=e:null),appInfo:e.appInfo,visible:a.value,conditionalUI:e.conditionalUI,changeEmail:e.changeEmail},{loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},8,["identifier","countryCode","appInfo","visible","conditionalUI","changeEmail"]),[[s.vShow,a.value]]),s.withDirectives(s.createVNode(Z,{identifier:o.value,"onUpdate:identifier":n[2]||(n[2]=e=>o.value=e),canToggleLoginRegister:!0,countryCode:s.unref(r),"onUpdate:countryCode":n[3]||(n[3]=e=>s.isRef(r)?r.value=e:null),appInfo:e.appInfo},null,8,["identifier","countryCode","appInfo"]),[[s.vShow,!a.value]]),s.createVNode(de,{"app-info":e.appInfo},null,8,["app-info"]),ge,s.createBaseVNode("div",ye,[a.value&&l.value?(s.openBlock(),s.createElementBlock("div",he,[s.createTextVNode(s.toDisplayString(s.unref(t)("dont-have-an-account"))+" ",1),s.createBaseVNode("a",{onClick:s.withModifiers(c,["prevent"]),role:"button",class:"body-link","data-testid":"register-link"},s.toDisplayString(s.unref(t)("register-here")),1)])):a.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",ke,[s.createTextVNode(s.toDisplayString(s.unref(t)("already-have-an-account"))+" ",1),s.createBaseVNode("a",{onClick:s.withModifiers(c,["prevent"]),role:"button",class:"body-link","data-testid":"login-link"},s.toDisplayString(s.unref(t)("login-here")),1)]))])]),s.createVNode(ee,{"app-info":e.appInfo},null,8,["app-info"])]))}});var Be=(e=>(e.LOGIN="psg_magic_link",e.VERIFY="psg_verify_link",e))(Be||{});const Ve=({magicLink:e,uiState:t,magicLinkUtils:n,passage:a})=>{const o=s.ref(null),i=()=>{t.uiLoading(),o.value={auth_token:"",redirect_url:""}},r=()=>{t.uiError()},c=()=>{n.invalidMagicLink.value=!0,t.uiError()},u=e=>l(this,[e],(function*({webauthnAllowed:e,magicLinkAction:n,result:a}){o.value=a,e&&n!==Be.VERIFY||(t.uiSuccess(),yield new Promise((e=>{setTimeout(e,2e3)}))),o.value.redirect_url&&W().emitEvent({type:n===Be.VERIFY?F.AuthSuccess:F.EmailOrSMSAuthSuccess,payload:{authResult:a}})}));return{authResult:o,onBeforeActivate:i,onActivateError:r,onActivateErrorInvalidMagicLink:c,onActivateSuccess:u,activateWithoutBiometrics:(t,n)=>l(this,null,(function*(){i();try{const o=yield a.magicLinkActivate(e);u({webauthnAllowed:t,magicLinkAction:n,result:o})}catch(o){o.statusCode===s.g.NotFound?c():r()}}))}},we={class:"auth-flex-container"},Ie={class:"image has-text-centered",style:{"margin-top":"16px"}},Ne={class:"has-text-centered","data-testid":"activate-magic-link-message",style:{"margin-top":"8px","margin-bottom":"40px"}},_e={key:0},Ce={key:1},Se={key:2},xe={key:3},Ee={key:4},De={key:0,class:"flex-row flex-center"},Te=["disabled"],Le={key:0},Me={key:1},Ae={key:2},Re=s.defineComponent({__name:"ActivateMagicLink",props:{magicLink:{},webauthnAllowed:{type:Boolean}},setup(e){const t=e,{t:n}=s.useLocale(),{passage:a}=s.usePassage(),o=function(){const e=s.ref(!1),t=s.ref(!1),n=s.ref(!1),a=s.ref(!0),{t:o}=s.useLocale(),i=s.computed((()=>t.value?o("success"):e.value?o("something-went-wrong"):o("log-in-with-a-passkey")));return{showFailure:e,showSuccess:t,loading:n,pageLoading:a,title:i,uiSuccess:()=>{t.value=!0,e.value=!1,n.value=!1},uiError:()=>{t.value=!1,e.value=!0,n.value=!1},uiLoading:()=>{t.value=!1,e.value=!1,n.value=!0}}}(),{showFailure:i,showSuccess:r,loading:c,pageLoading:u,title:d}=o,p=(e=>{const t=s.ref(),n=s.ref(!1);return{magicLinkAction:t,invalidMagicLink:n,isMagicLinkValid:()=>{const a=new URLSearchParams(window.location.href.split("?")[1]);return a.has("psg_magic_link")?t.value="psg_magic_link":a.has("psg_verify_link")&&(t.value="psg_verify_link"),t.value&&e||(n.value=!0),!n.value}}})(t.magicLink),{isMagicLinkValid:f,invalidMagicLink:v,magicLinkAction:m}=p,g=Ve({uiState:o,magicLinkUtils:p,passage:a,magicLink:t.magicLink});function y(){v.value?window.location.href=window.location.href.split("?")[0]:g.activateWithoutBiometrics(t.webauthnAllowed,m.value)}return s.onMounted((()=>l(this,null,(function*(){f()?(yield g.activateWithoutBiometrics(t.webauthnAllowed,m.value),L().onEvent.value(V.onMagicLinkActivateSuccess)):o.uiError(),u.value=!1})))),(e,t)=>(s.openBlock(),s.createBlock(s.Transition,{name:"fade",mode:"out-in",appear:""},{default:s.withCtx((()=>[s.withDirectives(s.createBaseVNode("div",we,[s.createBaseVNode("div",{class:s.normalizeClass(["title has-text-centered",[s.unref(r)?"main-title":"secondary-title"]])},s.toDisplayString(s.unref(i)?s.unref(v)?s.unref(n)("invalid-link"):s.unref(n)("device-login-failed-title"):s.unref(d)),3),s.createBaseVNode("figure",Ie,[s.unref(r)?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,src:s.unref(s.Icons).success,alt:"Magic link success"},null,8,["src"])):s.unref(i)?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).failure,alt:"Magic link failure"},null,8,["src"])):s.createCommentVNode("",!0)]),s.createBaseVNode("div",Ne,[s.unref(r)&&s.unref(m)===s.unref(Be).LOGIN?(s.openBlock(),s.createElementBlock("div",_e,s.toDisplayString(s.unref(n)("successfully-logged-in-redirect")),1)):s.unref(r)&&s.unref(m)===s.unref(Be).VERIFY?(s.openBlock(),s.createElementBlock("div",Ce,s.toDisplayString(s.unref(n)("successfully-changed-email")),1)):s.unref(i)&&s.unref(v)&&s.unref(m)===s.unref(Be).VERIFY?(s.openBlock(),s.createElementBlock("div",Se,s.toDisplayString(s.unref(n)("link-invalid")),1)):s.unref(i)&&s.unref(v)?(s.openBlock(),s.createElementBlock("div",xe,s.toDisplayString(s.unref(n)("login-link-invalid")),1)):s.unref(i)&&s.unref(m)===s.unref(Be).VERIFY?(s.openBlock(),s.createElementBlock("div",Ee,s.toDisplayString(s.unref(n)("verification-failed-please-try-again")),1)):s.createCommentVNode("",!0)]),s.unref(i)||s.unref(r)?(s.openBlock(),s.createElementBlock("div",De,[s.createBaseVNode("button",{onClick:s.withModifiers(y,["prevent"]),type:"button",class:s.normalizeClass(["button is-primary",{"is-loading":s.unref(c)}]),part:"button",disabled:s.unref(c),"data-testid":"activate-magic-link-button"},[s.unref(i)&&s.unref(v)?(s.openBlock(),s.createElementBlock("span",Le,s.toDisplayString(s.unref(n)("request-new-link")),1)):s.unref(i)?(s.openBlock(),s.createElementBlock("span",Me,s.toDisplayString(s.unref(n)("try-again")),1)):s.unref(r)?(s.openBlock(),s.createElementBlock("span",Ae,s.toDisplayString(s.unref(n)("redirect-now")),1)):s.createCommentVNode("",!0)],10,Te)])):s.createCommentVNode("",!0)],512),[[s.vShow,!s.unref(u)]])])),_:1}))}}),Ue={class:"view-verify-token"},Pe=s.defineComponent({__name:"ActivateMagicLinkView",props:{magicLink:{},webauthnAllowed:{type:Boolean}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Ue,[s.createVNode(Re,{magicLink:e.magicLink,webauthnAllowed:e.webauthnAllowed},null,8,["magicLink","webauthnAllowed"])]))}),Oe={class:"view-email-input"},Fe=s.defineComponent({__name:"LoginView",props:{register:{type:Boolean},appInfo:{},conditionalUI:{type:Boolean},changeEmail:{type:Boolean}},setup(e){const t=s.ref(""),{defaultCountryCode:n}=s.useDefaultCountryCode(),a=n;return(e,n)=>(s.openBlock(),s.createElementBlock("div",Oe,[s.createVNode(K,{identifier:t.value,"onUpdate:identifier":n[0]||(n[0]=e=>t.value=e),countryCode:s.unref(a),"onUpdate:countryCode":n[1]||(n[1]=e=>s.isRef(a)?a.value=e:null),canToggleLoginRegister:!1,appInfo:e.appInfo,conditionalUI:e.conditionalUI,changeEmail:e.changeEmail},{loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},8,["identifier","countryCode","appInfo","conditionalUI","changeEmail"]),s.createVNode(de,{"app-info":e.appInfo},null,8,["app-info"]),s.createVNode(ee,{"app-info":e.appInfo},null,8,["app-info"])]))}}),je={class:"view-email-input"},$e=s.defineComponent({__name:"RegisterView",props:{register:{type:Boolean},appInfo:{}},setup(e){const t=s.ref(""),{defaultCountryCode:n}=s.useDefaultCountryCode(),a=n;return(e,n)=>(s.openBlock(),s.createElementBlock("div",je,[s.createVNode(Z,{identifier:t.value,"onUpdate:identifier":n[0]||(n[0]=e=>t.value=e),countryCode:s.unref(a),"onUpdate:countryCode":n[1]||(n[1]=e=>s.isRef(a)?a.value=e:null),canToggleLoginRegister:!1,appInfo:e.appInfo},null,8,["identifier","countryCode","appInfo"]),s.createVNode(de,{"app-info":e.appInfo},null,8,["app-info"]),s.createVNode(ee,{"app-info":e.appInfo},null,8,["app-info"])]))}}),ze=s.defineComponent({name:"Spinner"}),He={class:"spinner-box"},Ge={class:"spinner-content"};var We=s._export_sfc(ze,[["render",function(e,t,n,a,o,i){return s.openBlock(),s.createElementBlock("div",He,[s.createBaseVNode("div",Ge,[s.renderSlot(e.$slots,"default")])])}]]);const Ke={class:"auth-flex-container"},qe={class:"title has-text-centered"},Ye={key:0,class:"content has-text-centered",style:{"margin-bottom":"40px !important"}},Ze=["innerHTML"],Je={class:"flex-row flex-center"},Qe=["disabled"],Xe=s.createBaseVNode("div",{class:"spacer"},null,-1),et={class:"link has-text-centered"},tt=s.defineComponent({__name:"MagicLink",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup(e){const t=e,{t:n,locale:a}=s.useLocale(),{passage:o}=s.usePassage(),{emitEvent:i}=W(),r=s.computed((()=>t.identifierType===d.email)),c=s.computed((()=>t.identifierVerifying?r.value?t.userIsRegistering?n("verify-email-to-register"):n("verify-email-to-login"):t.userIsRegistering?n("verify-phone-to-register"):n("verify-phone-to-login"):r.value?t.userIsRegistering?n("check-email-to-register"):n("check-email-to-login"):t.userIsRegistering?n("check-phone-to-register"):n("check-phone-to-login"))),u=s.computed((()=>{let e="";const a=t.identifierType===d.email?n("messagetype-email"):n("messagetype-sms"),o=t.identifierType===d.email?n("email"):n("phone-number"),i=t.userIsRegistering?n("registration"):n("login"),r=t.identifierVerifying?n("please-verify-identifier",[o,i]):n("you-will-be-automatically-signed-in");return e=n("weve-sent-messagetype",[a,t.identifier,r]),t.setupNewDevice&&!t.userIsRegistering&&(e=n("we-dont-recognize-this-device")+" "+e),e}));function p(){localStorage.removeItem("email"),localStorage.removeItem("magic_link_id"),localStorage.removeItem("wait_count"),b(721),i({type:F.ChangeIdentifier,payload:void 0})}function f(){return l(this,null,(function*(){yield g()}))}s.onMounted((()=>{t.userIsRegistering?function(){l(this,null,(function*(){v.value=!1,m.value=!0,yield new Promise((e=>{setTimeout(e,2e3)}));try{const e=yield o.newRegisterMagicLink(t.identifier,a.value.split("-")[0]);""!=e.id&&(localStorage.setItem("magic_link_id",e.id),b(0))}catch(e){console.log("magicLinkSend error",e)}finally{m.value=!1}}))}():g()}));const v=s.ref(!1),m=s.ref(!0);function g(){return l(this,null,(function*(){v.value=!1,m.value=!0;try{const e=yield o.newLoginMagicLink(t.identifier,a.value.split("-")[0]);""!=e.id&&(localStorage.setItem("magic_link_id",e.id),b(0))}catch(e){console.log("magicLinkSend error",e)}finally{yield new Promise((e=>{setTimeout(e,3e3)})),m.value=!1}}))}let y,h;function k(){return l(this,null,(function*(){const e=localStorage.getItem("magic_link_id");yield function(e){return l(this,null,(function*(){yield o.getMagicLinkStatus(e).then((e=>{b(721),y=e})).catch((()=>{}))}))}(e).then((()=>l(this,null,(function*(){y&&""!=y.redirect_url&&(localStorage.removeItem("magic_link_id"),localStorage.removeItem("wait_count"),L().onEvent.value(V.onMagicLinkActivated),i({type:F.EmailOrSMSAuthSuccess,payload:{identifier:t.identifier,authResult:y}}))}))))}))}function b(e){let t=e;if(!(t<720))return clearTimeout(h),void(v.value=!1);v.value=!0,h=setTimeout((()=>l(this,null,(function*(){!function(e){k(),localStorage.setItem("wait_count",e.toString())}(t),t++,b(t)}))),5e3)}return(e,t)=>(s.openBlock(),s.createElementBlock("div",Ke,[s.createBaseVNode("div",qe,[s.createBaseVNode("span",null,s.toDisplayString(c.value),1)]),s.createVNode(We,null,{default:s.withCtx((()=>[r.value?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,src:s.unref(s.Icons).email,alt:"Email envelope"},null,8,["src"])):(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).phone,alt:"Message bubbles"},null,8,["src"]))])),_:1}),u.value?(s.openBlock(),s.createElementBlock("div",Ye,[s.createBaseVNode("span",{innerHTML:u.value},null,8,Ze)])):s.createCommentVNode("",!0),s.createBaseVNode("div",Je,[s.createBaseVNode("button",{onClick:s.withModifiers(f,["prevent"]),type:"button",class:"button is-primary",part:"button",disabled:m.value},s.toDisplayString(s.unref(n)("resend-isemail-email-message",[r.value?s.unref(n)("email"):s.unref(n)("message")])),9,Qe)]),Xe,s.createBaseVNode("div",et,[s.createBaseVNode("a",{onClick:s.withModifiers(p,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(n)("change-isemail-email-phone",[r.value?s.unref(n)("email"):s.unref(n)("phone")])),1)])]))}}),nt={class:"view-access-token auth-flex-container"},at=s.defineComponent({__name:"MagicLinkView",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",nt,[s.createVNode(tt,{identifier:e.identifier,userIsRegistering:e.userIsRegistering,identifierVerifying:e.identifierVerifying,setupNewDevice:e.setupNewDevice,identifierType:e.identifierType},null,8,["identifier","userIsRegistering","identifierVerifying","setupNewDevice","identifierType"])]))}),ot={class:"passage-learnmore-modal"},it={class:"passage-learnmore-top"},rt={class:"passage-learnmore-close-button"},lt={class:"passage-learnmore-content"},st={style:{"margin-bottom":"32px"}},ct=s.defineComponent({__name:"LearnMoreLayout",setup(e){const{t:t}=s.useLocale(),n=s.ref(!1);return(e,a)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[n.value?(s.openBlock(),s.createElementBlock("div",{key:0,class:"passage-learnmore",onClick:a[1]||(a[1]=e=>n.value=!1)},[s.createBaseVNode("div",ot,[s.createBaseVNode("div",it,[s.createBaseVNode("div",{style:{cursor:"pointer"},onClick:a[0]||(a[0]=e=>n.value=!1)},[s.createBaseVNode("span",rt,s.toDisplayString(s.unref(t)("close")),1),s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).close},null,8,["src"])])]),s.createBaseVNode("div",lt,[s.renderSlot(e.$slots,"body")])])])):s.createCommentVNode("",!0),s.createBaseVNode("div",null,[s.createBaseVNode("div",st,[s.createBaseVNode("span",null,[s.renderSlot(e.$slots,"cta"),s.createTextVNode("   ")]),s.createBaseVNode("a",{style:{"text-decoration":"underline"},onClick:a[2]||(a[2]=e=>n.value=!0),role:"button"},s.toDisplayString(s.unref(t)("learn-more")),1),s.createTextVNode(" → ")])])],64))}}),ut={style:{"margin-bottom":"12px"}},dt={class:"passage-learnmore-header"},pt={class:"passage-learnmore-body"},ft={class:"passage-learnmore-header"},vt={class:"passage-learnmore-body"},mt={class:"passage-learnmore-header"},gt={class:"passage-learnmore-body"},yt=s.defineComponent({__name:"LearnMorePasskey",props:{cta:{}},setup(e){const{t:t}=s.useLocale();return(e,n)=>(s.openBlock(),s.createBlock(ct,null,{cta:s.withCtx((()=>[s.createBaseVNode("div",ut,s.toDisplayString(s.unref(t)("passkeys-are-a-simple")),1),s.createTextVNode(" "+s.toDisplayString(e.cta),1)])),body:s.withCtx((()=>[s.createBaseVNode("div",dt,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).privateIcon,style:{"margin-right":"8px"}},null,8,["src"]),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("private")),1)]),s.createBaseVNode("div",pt,s.toDisplayString(s.unref(t)("unlock-your-passkey")),1),s.createBaseVNode("div",ft,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).secure,style:{"margin-right":"8px"}},null,8,["src"]),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("secure")),1)]),s.createBaseVNode("div",vt,s.toDisplayString(s.unref(t)("passkey-is-unique")),1),s.createBaseVNode("div",mt,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).simple,style:{"margin-right":"8px"}},null,8,["src"]),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("simple")),1)]),s.createBaseVNode("div",gt,s.toDisplayString(s.unref(t)("easy-to-use")),1)])),_:1}))}}),ht={class:"auth-flex-container","data-tag":"register-device-message"},kt={class:"title secondary-title has-text-centered"},bt={class:"image has-text-centered"},Bt={key:0},Vt={key:1},wt={key:1},It={style:{"margin-bottom":"12px"}},Nt={style:{"margin-bottom":"24px"}},_t={key:2},Ct={style:{"margin-bottom":"32px"}},St={key:2,class:"flex-row flex-center"},xt=["disabled"],Et=["disabled"],Dt={key:3,class:"flex-column flex-center",style:{margin:"auto"}},Tt=["disabled"],Lt=["disabled"],Mt=s.createBaseVNode("div",{class:"spacer"},null,-1),At={key:4,class:"content has-text-centered",style:{"margin-top":"20px !important"}},Rt={class:"link"},Ut={class:"link"},Pt={key:0,class:"link"},Ot=s.defineComponent({__name:"RegisterDevice",props:{identifier:{},identifierType:{},appInfo:{},passkeyFeatures:{}},setup(e){const t=e,n=s.ref(!1),a=s.ref(!1),{t:o,te:i}=s.useLocale(),{passage:r}=s.usePassage(),{emitEvent:c}=W(),{autofocusButton:u}=p(),f=s.computed((()=>t.passkeyFeatures.platform)),v=s.computed((()=>t.passkeyFeatures.securityKey)),m=s.computed((()=>t.identifierType===d.email)),g=s.computed((()=>R(t.appInfo))),y=s.computed((()=>g.value!==A.None)),h=s.computed((()=>g.value===A.SMS?i("register-with-code")?o("register-with-code"):"Register with a code":o("register-with-link",[m.value?o("email"):o("sms-text")]))),k=s.computed((()=>g.value===A.SMS?i("send-code")?o("send-code"):"Send code":o("send-email-or-text-link",[m.value?o("email"):o("sms-text")]))),b=s.computed((()=>{switch(g.value){case A.SMS:return i("passkey-create-fail-try-code")?o("passkey-create-fail-try-code"):"Unable to create a passkey. Try again or register with a one-time code.";case A.Email:return o("passkey-create-fail-try-link");case A.None:return o("passkey-create-fail-no-fallback")}}));let B=s.T.Platform;function V(e,o){return l(this,null,(function*(){a.value=!0;try{B=o;const n=yield r.register(e,{authenticatorAttachment:o});a.value=!1,c({type:F.AuthSuccess,payload:{authResult:n,identifier:t.identifier}})}catch(i){n.value=!0,a.value=!1}}))}function w(){c({type:F.EmailOrSMSAuth,payload:{identifier:t.identifier,identifierType:t.identifierType,userIsRegistering:!0,userInitiated:!0}})}function I(){localStorage.removeItem("email"),W().emitEvent({type:F.ChangeIdentifier,payload:void 0})}function N(){!0===f.value?V(t.identifier,s.T.Platform):V(t.identifier,s.T.CrossPlatform)}function _(){V(t.identifier,s.T.CrossPlatform)}function C(){V(t.identifier,B)}return(e,t)=>(s.openBlock(),s.createElementBlock("div",ht,[s.createBaseVNode("div",kt,s.toDisplayString(f.value?s.unref(o)("register-with-a-passkey"):s.unref(o)("register-passkey-another-device")),1),s.createBaseVNode("figure",bt,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkey,alt:"Register with a passkey"},null,8,["src"])]),n.value?(s.openBlock(),s.createElementBlock("div",Bt,[s.createBaseVNode("p",null,s.toDisplayString(b.value),1)])):(s.openBlock(),s.createElementBlock("div",Vt,[f.value&&!v.value?(s.openBlock(),s.createBlock(yt,{key:0,cta:s.unref(o)("register-your-account")},null,8,["cta"])):s.createCommentVNode("",!0),f.value&&v.value?(s.openBlock(),s.createElementBlock("div",wt,[s.createBaseVNode("div",It,s.toDisplayString(s.unref(o)("passkeys-are-a-simple")),1),s.createBaseVNode("div",Nt,s.toDisplayString(s.unref(o)("passkey-register-options")),1)])):s.createCommentVNode("",!0),!f.value&&v.value?(s.openBlock(),s.createElementBlock("div",_t,[s.createBaseVNode("div",Ct,s.toDisplayString(s.unref(o)("passkeys-not-supported-try-another-device")),1)])):s.createCommentVNode("",!0)])),n.value?(s.openBlock(),s.createElementBlock("div",St,[s.createBaseVNode("button",{onClick:s.withModifiers(C,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:a.value,style:{"margin-right":"5px"}},s.toDisplayString(s.unref(o)("try-again")),9,xt),y.value?(s.openBlock(),s.createElementBlock("button",{key:0,onClick:s.withModifiers(w,["prevent"]),type:"button",part:"button button-secondary",class:"button is-secondary",disabled:a.value,style:{"margin-left":"5px"},"data-testid":"login-with-email-button",ref_key:"autofocusButton",ref:u},s.toDisplayString(k.value),9,Et)):s.createCommentVNode("",!0)])):(s.openBlock(),s.createElementBlock("div",Dt,[s.createBaseVNode("button",{onClick:s.withModifiers(N,["prevent"]),type:"button",class:s.normalizeClass(["button",[{"is-loading":a.value}]]),part:"button",disabled:a.value,"data-testid":"register-main-button",tabindex:"0",ref_key:"autofocusButton",ref:u,style:{margin:"8px 0px"}},[s.createBaseVNode("span",null,s.toDisplayString(f.value?s.unref(o)("register-with-passkey"):s.unref(o)("use-another-device")),1)],10,Tt),f.value&&v.value?(s.openBlock(),s.createElementBlock("button",{key:0,onClick:s.withModifiers(_,["prevent"]),type:"button",class:s.normalizeClass(["button is-secondary",[{"is-loading":a.value}]]),part:"button button-secondary",style:{width:"100%",margin:"8px 0px"},disabled:a.value,"data-testid":"register-secondary-button",tabindex:"0",ref_key:"autofocusButton",ref:u},[s.createBaseVNode("span",null,s.toDisplayString(s.unref(o)("use-another-device")),1)],10,Lt)):s.createCommentVNode("",!0)])),Mt,n.value?(s.openBlock(),s.createElementBlock("div",At,[s.createBaseVNode("div",Rt,[s.createBaseVNode("a",{onClick:s.withModifiers(I,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(o)("change-isemail-email-phone",[m.value?s.unref(o)("email"):s.unref(o)("phone")])),1)])])):s.createCommentVNode("",!0),n.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:5,class:s.normalizeClass(["flex-row flex-wrap",y.value?"flex-between":"flex-center"])},[s.createBaseVNode("div",Ut,[s.createBaseVNode("a",{onClick:s.withModifiers(I,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(o)("back")),1)]),y.value?(s.openBlock(),s.createElementBlock("div",Pt,[s.createBaseVNode("a",{onClick:s.withModifiers(w,["prevent"]),role:"button","data-testid":"register-email-button"},s.toDisplayString(h.value),1)])):s.createCommentVNode("",!0)],2))]))}}),Ft=s.defineComponent({__name:"RegisterDeviceView",props:{identifier:{},identifierType:{},appInfo:{},passkeyFeatures:{}},setup(e){const t=e;return(e,n)=>(s.openBlock(),s.createBlock(Ot,s.normalizeProps(s.guardReactiveProps(t)),null,16))}}),jt={class:"auth-flex-container"},$t={class:"title has-text-centered"},zt={class:"image has-text-centered",style:{"margin-top":"8px"}},Ht={key:1,class:"wrap-text",style:{"margin-bottom":"5px !important"}},Gt={"data-testid":"failure-message"},Wt={style:{margin:"0px","margin-top":"8px","margin-bottom":"40px"}},Kt={key:2,class:"flex-row flex-center"},qt=["disabled"],Yt=["disabled"],Zt=s.createBaseVNode("div",{class:"spacer"},null,-1),Jt={key:3,class:"content has-text-centered",style:{"margin-top":"20px !important"}},Qt={class:"link"},Xt={class:"link"},en={key:0,class:"link"},tn=s.defineComponent({__name:"WebauthnSignIn",props:{identifier:{},identifierType:{},appInfo:{},userIsVerifying:{type:Boolean}},setup(e){const t=e,n=s.ref(!1),a=s.ref(!1),{t:o,te:i}=s.useLocale(),{passage:r}=s.usePassage(),{emitEvent:c}=W(),u=s.computed((()=>t.userIsVerifying?o("verify-account"):o("log-in-with-a-passkey"))),f=s.computed((()=>t.identifierType===d.email)),{autofocusButton:v}=p(),m=s.computed((()=>R(t.appInfo))),g=s.computed((()=>m.value!==A.None)),y=s.computed((()=>m.value===A.SMS?i("send-code")?o("send-code"):"Send code":o("send-email-or-text-link",[f.value?o("email"):o("sms-text")]))),h=s.computed((()=>m.value===A.SMS?i("login-with-code")?o("login-with-code"):"Login with a code":o("login-with-link",[f.value?o("email"):o("sms-text")]))),k=s.computed((()=>{switch(m.value){case A.SMS:return i("passkey-login-fail-try-code")?o("passkey-login-fail-try-code"):"Unable to log in with a passkey. Try again or log in with a one-time code.";case A.Email:return o("passkey-login-fail-try-link");case A.None:return o("passkey-login-fail-no-fallback")}}));function b(){return l(this,null,(function*(){if(n.value=!1,t.identifier){a.value=!0;try{const e=yield r.login(t.identifier);c({type:F.AuthSuccess,payload:{authResult:e,identifier:t.identifier}}),a.value=!1}catch(e){const o=e;n.value=!0,a.value=!1,o.statusCode===s.g.PSGParsePublicKeyForLoginFailed?n.value=!0:c({type:F.EmailOrSMSAuth,payload:{identifier:t.identifier,identifierType:t.identifierType,userInitiated:!1}})}}}))}function B(){c({type:F.EmailOrSMSAuth,payload:{identifier:t.identifier,identifierType:t.identifierType,userInitiated:!0}})}function V(){localStorage.removeItem("email"),c({type:F.ChangeIdentifier,payload:void 0})}return s.onMounted((()=>{b()})),(e,t)=>(s.openBlock(),s.createElementBlock("div",jt,[s.createBaseVNode("div",$t,s.toDisplayString(u.value),1),s.createBaseVNode("figure",zt,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkey,alt:"Log in with a passkey",style:{margin:"5px"}},null,8,["src"])]),n.value?n.value?(s.openBlock(),s.createElementBlock("div",Ht,[s.createBaseVNode("div",Gt,[s.createBaseVNode("p",Wt,s.toDisplayString(k.value),1)])])):s.createCommentVNode("",!0):(s.openBlock(),s.createBlock(yt,{key:0,cta:s.unref(o)("log-into-your-account")},null,8,["cta"])),n.value?(s.openBlock(),s.createElementBlock("div",Kt,[s.createBaseVNode("button",{onClick:s.withModifiers(b,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:a.value,style:{"margin-right":"5px"}},s.toDisplayString(s.unref(o)("try-again")),9,qt),g.value?(s.openBlock(),s.createElementBlock("button",{key:0,onClick:s.withModifiers(B,["prevent"]),type:"button",part:"button button-secondary",class:"button is-secondary",disabled:a.value,style:{"margin-left":"5px"},"data-testid":"login-with-email-button",ref_key:"autofocusButton",ref:v},s.toDisplayString(y.value),9,Yt)):s.createCommentVNode("",!0)])):s.createCommentVNode("",!0),Zt,n.value?(s.openBlock(),s.createElementBlock("div",Jt,[s.createBaseVNode("div",Qt,[s.createBaseVNode("a",{onClick:s.withModifiers(V,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(o)("change-isemail-email-phone",[f.value?s.unref(o)("email"):s.unref(o)("phone")])),1)])])):s.createCommentVNode("",!0),n.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:4,class:s.normalizeClass(["flex-row flex-wrap",g.value?"flex-between":"flex-center"])},[s.createBaseVNode("div",Xt,[s.createBaseVNode("a",{onClick:s.withModifiers(V,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(o)("back")),1)]),g.value?(s.openBlock(),s.createElementBlock("div",en,[s.createBaseVNode("a",{onClick:s.withModifiers(B,["prevent"]),role:"button","data-testid":"register-email-button"},s.toDisplayString(h.value),1)])):s.createCommentVNode("",!0)],2))]))}}),nn={class:"view-webauthn-sign-in auth-flex-container"},an=s.defineComponent({__name:"WebauthnSignInView",props:{identifier:{},identifierType:{},appInfo:{},userIsVerifying:{type:Boolean}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",nn,[s.createVNode(tn,{identifier:e.identifier,identifierType:e.identifierType,appInfo:e.appInfo,userIsVerifying:e.userIsVerifying},null,8,["identifier","identifierType","appInfo","userIsVerifying"])]))}),on={style:{display:"flex","align-items":"center"},class:"psg-otp-single-input-container"},rn=["data-testid","type","inputtype","placeholder","inputmode","disabled","maxlength","autocomplete"],ln={key:0},sn=["innerHTML"],cn=s.defineComponent({__name:"OneTimePasscodeSingleInput",props:{conditionalClass:{},focus:{type:Boolean},inputClasses:{default:()=>[]},inputmode:{default:"numeric"},inputType:{default:"number"},isDisabled:{type:Boolean},isLastChild:{type:Boolean},placeholder:{},separator:{default:""},shouldAutoFocus:{type:Boolean,default:!1},value:{default:""},isFirstChild:{type:Boolean},inputIdx:{},inputCount:{}},emits:["on-change","on-keydown","on-paste","on-focus","on-blur"],setup(e,{emit:t}){const n=e,a=t,o=s.ref(n.value||""),i=s.ref(null),r=s.computed((()=>"letter-numeric"===n.inputType?"text":n.inputType)),l=()=>(o.value=o.value.toString(),o.value.length>1&&(o.value=o.value.slice(0,1)),a("on-change",o.value)),c=e=>{n.isDisabled&&e.preventDefault();const t=e||window.event,o=t.which?t.which:t.keyCode;(e=>e>=48&&e<=57||e>=96&&e<=105)(o)||"letter-numeric"===n.inputType&&(e=>e>=65&&e<=90)(o)||[8,9,13,37,39,46,86].includes(o)?a("on-keydown",e):t.preventDefault()},u=e=>a("on-paste",e),d=()=>(i.value.select(),a("on-focus")),p=()=>a("on-blur");return s.watch((()=>n.value),((e,t)=>{e!==t&&(o.value=e)})),s.watch((()=>n.focus),((e,t)=>{t!==e&&i.value&&n.focus&&(i.value.focus(),i.value.select())})),s.onMounted((()=>{i.value&&n.focus&&n.shouldAutoFocus&&(i.value.focus(),i.value.select())})),(e,t)=>(s.openBlock(),s.createElementBlock("div",on,[s.withDirectives(s.createBaseVNode("input",{"data-testid":`otp-single-input-${e.inputIdx}`,type:r.value,inputtype:r.value,placeholder:e.placeholder,inputmode:e.inputmode,disabled:e.isDisabled,ref_key:"input",ref:i,pattern:"[0-9]*",maxlength:e.isFirstChild?e.inputCount:1,min:"0",max:"9","onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),class:s.normalizeClass(["psg-input","psg-otp-input",[...e.inputClasses||[]]]),onInput:l,onKeydown:c,onPaste:u,onFocus:d,onBlur:p,autocomplete:e.isFirstChild?"one-time-code":"off"},null,42,rn),[[s.vModelDynamic,o.value]]),!e.isLastChild&&e.separator?(s.openBlock(),s.createElementBlock("span",ln,[s.createBaseVNode("span",{innerHTML:e.separator},null,8,sn)])):s.createCommentVNode("",!0)]))}}),un={style:{display:"flex","justify-content":"space-between"},class:"psg-otp-input-container"},dn={key:0,autocomplete:"off",name:"hidden",type:"text",style:{display:"none"}},pn=s.defineComponent({__name:"OneTimePasscodeInput",props:{value:{default:""},numInputs:{default:6},separator:{default:""},inputClasses:{},conditionalClass:{default:()=>[]},inputType:{default:"number"},inputmode:{default:"numeric"},shouldAutoFocus:{type:Boolean,default:!1},placeholder:{default:()=>[]},isDisabled:{type:Boolean,default:!1},disableNonCurrent:{type:Boolean,default:!1}},emits:["update:value","on-complete","on-change"],setup(e,{emit:t}){const n=e,a=t,o=s.ref(0),i=s.ref([]),r=s.ref([]);s.watch((()=>n.value),(e=>{const t=(s.unref(e)||"").padEnd(n.numInputs," ").split("");i.value=t}),{immediate:!0});const l=()=>{o.value=-1},c=e=>{o.value=Math.max(Math.min(n.numInputs-1,e),0)},u=()=>{n.disableNonCurrent?setTimeout((()=>{c(o.value+1)}),200):c(o.value+1)},d=()=>{c(o.value-1)},p=e=>{r.value=Object.assign([],i.value),i.value[o.value]=e,r.value.join("")!==i.value.join("")&&(a("update:value",i.value.join("")),a("on-change",i.value.join("")))},f=e=>{var t;e.preventDefault();const r=null==(t=e.clipboardData)?void 0:t.getData("text/plain").slice(0,n.numInputs-o.value).split("");if("number"===n.inputType&&!(null==r?void 0:r.join("").match(/^\d+$/)))return"Invalid pasted data";if("letter-numeric"===n.inputType&&!(null==r?void 0:r.join("").match(/^\w+$/)))return"Invalid pasted data";const l=i.value.slice(0,o.value).concat(r||"");return l.slice(0,n.numInputs).forEach(((e,t)=>{i.value[t]=e})),c(l.slice(0,n.numInputs).length),i.value.join("").length===n.numInputs?(a("update:value",i.value.join("")),a("on-complete",i.value.join(""))):"Wait until the user enters the required number of characters"},v=e=>{p(e),u()},m=e=>{switch(e.keyCode){case 8:e.preventDefault(),p(""),d();break;case 46:e.preventDefault(),p("");break;case 37:e.preventDefault(),d();break;case 39:e.preventDefault(),u()}};return(e,t)=>(s.openBlock(),s.createElementBlock("div",un,["password"===e.inputType?(s.openBlock(),s.createElementBlock("input",dn)):s.createCommentVNode("",!0),(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(e.numInputs,((t,n)=>(s.openBlock(),s.createBlock(cn,{key:n,focus:o.value===n,value:i.value[n],separator:e.separator,"input-type":e.inputType,inputmode:e.inputmode,"input-classes":e.inputClasses,conditionalClass:e.conditionalClass[n],"is-last-child":n===e.numInputs-1,"is-first-child":0===n,"should-auto-focus":e.shouldAutoFocus,placeholder:e.placeholder[n],"is-disabled":e.isDisabled||e.disableNonCurrent&&n>i.value.join("").trim().length,"input-idx":n,"input-count":e.numInputs,onOnChange:v,onOnKeydown:m,onOnPaste:f,onOnFocus:e=>{return t=n,void(o.value=t);var t},onOnBlur:l},null,8,["focus","value","separator","input-type","inputmode","input-classes","conditionalClass","is-last-child","is-first-child","should-auto-focus","placeholder","is-disabled","input-idx","input-count","onOnFocus"])))),128))]))}}),fn={class:"auth-flex-container"},vn={class:"flex flex-column",style:{"flex-grow":"1"}},mn={class:"title has-text-centered"},gn={class:"content wrap-text"},yn={style:{"margin-top":"32px","margin-bottom":"40px"}},hn=["innerHTML"],kn={class:"flex flex-row flex-center"},bn={class:"flex-row",style:{"margin-top":"8px"}},Bn={class:"error-message",style:{"min-height":"17px"}},Vn={class:"flex-row flex-center",style:{"margin-top":"16px"}},wn=["disabled"],In=s.createBaseVNode("div",{class:"spacer"},null,-1),Nn={class:"flex-row flex-wrap flex-between"},_n={class:"link"},Cn={class:"link"},Sn=s.defineComponent({__name:"OneTimePasscode",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup(e){const t=e,{t:n,te:a,locale:o}=s.useLocale(),i=s.ref(!0),r=s.ref(void 0),c=s.ref(!1),u=s.ref(!1),d=s.ref(void 0),p=s.ref(void 0),f=s.computed((()=>t.identifierVerifying?n("verify-account"):n("enter-code"))),v=s.computed((()=>a("enter-code-sent")?n("enter-code-sent",[t.identifier]):`A one-time code has been sent to <span style="font-weight: 700;">${t.identifier}</span>. Enter the code here to log in.`)),m=s.computed((()=>a("back")?n("back"):"Back")),g=s.computed((()=>a("resend-code")?n("resend-code"):"Resend code")),y=s.computed((()=>c.value?["has-error"]:[])),h=s.computed((()=>false)),k=s.computed((()=>i.value));s.watch(r,(()=>{var e;S(),6===(null==(e=r.value)?void 0:e.trim().length)&&w()}));const{passage:b}=s.usePassage(),B=(e=!1)=>l(this,null,(function*(){C(),S(),x(),i.value=!0;try{const n=e?yield b.newRegisterOneTimePasscode(t.identifier,o.value.split("-")[0]):yield b.newLoginOneTimePasscode(t.identifier,o.value.split("-")[0]);""!=n.otp_id&&(localStorage.setItem("otp_id",n.otp_id),p.value=n.otp_id)}catch(r){E(a("code-send-error")?n("code-send-error"):"An error occurred sending the code.",!0)}finally{i.value=!1}})),w=()=>l(this,null,(function*(){C(),S(),i.value=!0;try{if(!r.value)throw new Error("Login code is undefined.");if(6!==r.value.length)throw new Error("Login code is invalid length.");if(!p.value)throw new Error("Login code id is undefined.");const e=yield b.oneTimePasscodeActivate(r.value,p.value);e&&""!=e.redirect_url&&(localStorage.removeItem("otp_id"),L().onEvent.value(V.onOneTimePasscodeActivated),W().emitEvent({type:F.EmailOrSMSAuthSuccess,payload:{identifier:t.identifier,authResult:e}}))}catch(e){e.statusCode===s.g.Unauthorized?E(n("otp-limit-error")):E(n("code-invalid-or-expired"))}finally{i.value=!1}})),I=()=>{W().emitEvent({type:F.ChangeIdentifier,payload:void 0})},N=()=>{B()},_=()=>{w()};s.onMounted((()=>{B(t.userIsRegistering),function(){const e=D.value.getRootNode().host;D.value.appendChild(function(){const e=document.createElement("style");return e.appendChild(document.createTextNode("\n      .psg-otp-input-container{\n        margin: 0px;\n        padding: 0px;\n        align-items: center;\n        height: auto;\n        width: auto;\n      }\n      .psg-otp-single-input-container{\n        margin: 0px;\n        padding: 0px;\n        height: auto;\n        width: auto;\n      }\n      .psg-otp-input {\n        width: 40px;\n        height: 40px;\n        padding: 0px;\n        margin-left: 4px;\n        margin-right: 4px;\n        font-size: 24px;\n        font-weight: 400;\n        color: var(--passage-input-text-color, var(--passage-body-text-color-default));\n        font-family: var(--passage-body-font-family, var(--passage-body-font-family-default));\n        line-height: 29px;\n        border-radius: 4px;\n        border: 1px solid var(--passage-control-border-color, var(--passage-control-border-color-default));\n        text-align: center;\n            background-color: var(\n                --passage-otp-input-background-color,\n                var(--passage-input-box-background-color, var(--passage-input-box-background-color-default))\n            );\n        -moz-appearance: textfield;\n      }\n      .psg-otp-input:read-only {\n            background-color: var(\n                --passage-otp-input-background-color,\n                var(--passage-input-box-background-color, var(--passage-input-box-background-color-default))\n            );\n      }\n      .psg-otp-input::-webkit-inner-spin-button{\n        -webkit-appearance: none;\n        display: none;\n        margin: 0;\n      }\n      .psg-otp-input::-webkit-outer-spin-button{\n        -webkit-appearance: none;\n        display: none;\n        margin: 0;\n      }\n      .psg-input.has-error{\n        border-color: var(--passage-error-color, var(--passage-error-color-default)) !important;\n      }\n      .psg-input.is-danger {\n        border-color: var(--passage-error-color, var(--passage-error-color-default)) !important;\n      }\n      .psg-input:focus {\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }\n      .psg-input:active {\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }")),e}()),e.appendChild(D.value)}()})),s.onBeforeUnmount((()=>{D.value.remove()}));const C=()=>{i.value=!0},S=()=>{d.value=void 0,c.value=!1,u.value=!1},x=()=>{r.value=void 0},E=(e,t=!1)=>{d.value=e,c.value=!t,u.value=t},D=s.ref();return(e,t)=>(s.openBlock(),s.createElementBlock("div",fn,[s.createBaseVNode("form",vn,[s.createBaseVNode("div",mn,[s.createBaseVNode("span",null,s.toDisplayString(f.value),1)]),s.createBaseVNode("div",gn,[s.createBaseVNode("div",yn,[s.createBaseVNode("p",{innerHTML:v.value},null,8,hn)])]),s.createBaseVNode("div",kn,[s.createBaseVNode("div",{ref_key:"otpInput",ref:D,slot:"otpInput"},[s.createVNode(pn,{"num-inputs":6,"is-disabled":h.value,value:r.value,"onUpdate:value":t[0]||(t[0]=e=>r.value=e),"input-classes":y.value,"disable-non-current":!1},null,8,["is-disabled","value","input-classes"])],512),s.renderSlot(e.$slots,"otpInput")]),s.createBaseVNode("div",bn,[s.createBaseVNode("div",Bn,s.toDisplayString(d.value?d.value:" "),1)]),s.createBaseVNode("div",Vn,[s.createBaseVNode("button",{type:"submit",class:"button is-primary",part:"button","data-testid":"continue-button",onClick:s.withModifiers(_,["prevent"]),disabled:k.value},s.toDisplayString(s.unref(n)("continue")),9,wn)]),In,s.createBaseVNode("div",Nn,[s.createBaseVNode("div",_n,[s.createBaseVNode("a",{onClick:s.withModifiers(I,["prevent"]),role:"button","data-testid":"one-time-passcode-goback-button"},s.toDisplayString(m.value),1)]),s.createBaseVNode("div",Cn,[s.createBaseVNode("a",{onClick:s.withModifiers(N,["prevent"]),role:"button","data-testid":"one-time-passcode-resend-button"},s.toDisplayString(g.value),1)])])])]))}}),xn={class:"view-access-token auth-flex-container"},En=s.defineComponent({__name:"OneTimePasscodeView",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",xn,[s.createVNode(Sn,{identifier:e.identifier,userIsRegistering:e.userIsRegistering,identifierVerifying:e.identifierVerifying,setupNewDevice:e.setupNewDevice,identifierType:e.identifierType},{otpInput:s.withCtx((()=>[s.renderSlot(e.$slots,"otpInput")])),_:3},8,["identifier","userIsRegistering","identifierVerifying","setupNewDevice","identifierType"])]))}),Dn={class:"title has-text-centered secondary-title","data-testid":"activate-magic-link-message"},Tn={class:"image has-text-centered",style:{"margin-bottom":"32px"}},Ln={key:0,class:"has-text-centered",style:{"margin-bottom":"32px"}},Mn={class:"flex-row flex-center",style:{"margin-bottom":"64px"}},An=["disabled"],Rn={key:0},Un={key:1},Pn={key:2,class:"link has-text-centered"},On=s.defineComponent({__name:"AddDevice",props:{authResult:{},identifier:{}},setup(e){const t=e,{t:n}=s.useLocale(),a=s.ref(!1),o=s.ref(!1),i=s.ref(),{addDevice:r,addPending:c}=s.useAddDevice(),{autofocusButton:u}=p(),d=s.computed((()=>a.value?n("something-went-wrong"):n("add-passkey")));function f(){return l(this,null,(function*(){var e;i.value=yield r(),(null==(e=i.value)?void 0:e.id)?(o.value=!0,a.value=!1,v()):(a.value=!0,o.value=!1)}))}const v=()=>{W().emitEvent({type:F.AuthSuccess,payload:{identifier:t.identifier,authResult:t.authResult}})};return(e,t)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createBaseVNode("div",Dn,s.toDisplayString(d.value),1),s.createBaseVNode("figure",Tn,[a.value?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,src:s.unref(s.Icons).failure,alt:"Device failure"},null,8,["src"])):(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).passkey,alt:"Add a passkey"},null,8,["src"]))]),a.value?(s.openBlock(),s.createElementBlock("div",Ln,s.toDisplayString(s.unref(n)("failed-to-add-this-device")),1)):(s.openBlock(),s.createBlock(yt,{key:1,cta:s.unref(n)("log-into-your-account")},null,8,["cta"])),s.createBaseVNode("div",Mn,[s.createBaseVNode("button",{onClick:s.withModifiers(f,["prevent"]),type:"button",class:s.normalizeClass(["button is-primary",{"is-loading":s.unref(c)}]),part:"button",disabled:s.unref(c),"data-testid":"save-device-button",ref_key:"autofocusButton",ref:u},[a.value?(s.openBlock(),s.createElementBlock("span",Rn,s.toDisplayString(s.unref(n)("try-again")),1)):(s.openBlock(),s.createElementBlock("span",Un,s.toDisplayString(s.unref(n)("add-passkey")),1))],10,An)]),o.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",Pn,[s.createBaseVNode("div",null,[s.createBaseVNode("a",{onClick:s.withModifiers(v,["prevent"]),role:"button","data-testid":"add-device-skip"},s.toDisplayString(s.unref(n)("skip")),1)])]))],64))}}),Fn={class:"view-add-device"},jn=s.defineComponent({__name:"AddDeviceView",props:{authResult:{},identifier:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Fn,[s.createVNode(On,{authResult:e.authResult,identifier:e.identifier},null,8,["authResult","identifier"])]))}),$n={class:"wrap-text",style:{"margin-bottom":"12px !important"}},zn={class:"passage-learnmore-header"},Hn={class:"passage-learnmore-body"},Gn={class:"passage-learnmore-header"},Wn={class:"passage-learnmore-body"},Kn=s.defineComponent({__name:"LearnMoreDisabledFallbacks",setup(e){const{t:t}=s.useLocale();return(e,n)=>(s.openBlock(),s.createBlock(ct,null,{cta:s.withCtx((()=>[s.createBaseVNode("div",$n,s.toDisplayString(s.unref(t)("passkeys-are-required"))+s.toDisplayString(" "),1),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("try-again-on-device-with-passkeys")),1)])),body:s.withCtx((()=>[s.createBaseVNode("div",zn,s.toDisplayString(s.unref(t)("what-are-passkeys")),1),s.createBaseVNode("div",Hn,s.toDisplayString(s.unref(t)("passkeys-are-a-simpler-and-more-secure-alternative")),1),s.createBaseVNode("div",Gn,s.toDisplayString(s.unref(t)("devices-that-support-passkeys")),1),s.createBaseVNode("div",Wn,s.toDisplayString(s.unref(t)("devices-with-a-biometric-sensor-are-likely-to-support-passkeys")),1)])),_:1}))}}),qn={class:"auth-flex-container"},Yn={class:"title has-text-centered"},Zn={class:"image has-text-centered"},Jn=s.createBaseVNode("div",{class:"spacer"},null,-1),Qn={class:"flex-row flex-wrap flex-center"},Xn={class:"link"},ea=s.defineComponent({__name:"DisableFallbacks",setup(e){const{t:t}=s.useLocale(),{emitEvent:n}=W();function a(){localStorage.removeItem("email"),n({type:F.ChangeIdentifier,payload:void 0})}return(e,n)=>(s.openBlock(),s.createElementBlock("div",qn,[s.createBaseVNode("div",Yn,s.toDisplayString(s.unref(t)("device-not-supported")),1),s.createBaseVNode("figure",Zn,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkeyArrow,alt:"Device not supported"},null,8,["src"])]),s.createVNode(Kn),Jn,s.createBaseVNode("div",Qn,[s.createBaseVNode("div",Xn,[s.createBaseVNode("a",{onClick:s.withModifiers(a,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(t)("back")),1)])])]))}}),ta=s.defineComponent({__name:"DisableFallbackView",setup:e=>(e,t)=>(s.openBlock(),s.createBlock(ea))}),na={class:"auth-flex-container"},aa={class:"title has-text-centered"},oa={class:"image has-text-centered"},ia={class:"wrap-text",style:{"margin-bottom":"12px !important"}},ra={class:"wrap-text"},la=s.createBaseVNode("div",{class:"spacer"},null,-1),sa={class:"flex-row flex-wrap flex-center"},ca={class:"link"},ua=s.defineComponent({__name:"LoginNotSupported",setup(e){const{t:t}=s.useLocale(),{emitEvent:n}=W();function a(){localStorage.removeItem("email"),n({type:F.ChangeIdentifier,payload:void 0})}return(e,n)=>(s.openBlock(),s.createElementBlock("div",na,[s.createBaseVNode("div",aa,s.toDisplayString(s.unref(t)("login-not-supported")),1),s.createBaseVNode("figure",oa,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkeyArrow,alt:"Device not supported"},null,8,["src"])]),s.createBaseVNode("div",ia,s.toDisplayString(s.unref(t)("passkeys-are-now-required")),1),s.createBaseVNode("div",ra,s.toDisplayString(s.unref(t)("please-contact-support-to-regain-access")),1),la,s.createBaseVNode("div",sa,[s.createBaseVNode("div",ca,[s.createBaseVNode("a",{onClick:s.withModifiers(a,["prevent"]),role:"button","data-testid":"change-email-button"},s.toDisplayString(s.unref(t)("back")),1)])])]))}}),da=s.defineComponent({__name:"LoginNotSupportedView",setup:e=>(e,t)=>(s.openBlock(),s.createBlock(ua))}),pa={class:"auth-flex-container flex-center"},fa={class:"title has-text-centered"},va={class:"flex-column flex-center",style:{"margin-bottom":"32px"}},ma={key:2},ga={style:{"margin-bottom":"40px"}},ya=s.createBaseVNode("div",{class:"spacer"},null,-1),ha={key:2,class:"link has-text-centered"},ka=s.defineComponent({__name:"LinkAccount",props:{identifier:{},code:{}},setup(e){const t=e,{t:n}=s.useLocale(),{theme:a}=s.useTheme(),{emitEvent:o}=W(),{passage:i}=s.usePassage(),r=s.ref(!1),u=sessionStorage.getItem("oauth2Connection"),d=c.socialConnectionMetadata[u],p=s.computed((()=>r.value?n("link-account-failed"):n("link-your-account-to-social-provider",[n(null!=u?u:"")]))),f=s.computed((()=>`${n(d.nameKey)} icon`)),v=s.computed((()=>r.value?n("session-invalid"):n("found-existing-account",[n(null!=u?u:"")]))),m=s.computed((()=>{switch(a.value){case s.Theme.Dark:return d.icons.dark;case s.Theme.Light:default:return d.icons.light}}));function g(){o({type:F.ChangeIdentifier,payload:void 0})}function y(){return l(this,null,(function*(){try{const e=yield i.finishSocialAuthentication(t.code);o({type:F.AuthSuccess,payload:{authResult:e}})}catch(e){const t=e;console.error(t.message),r.value=!0}}))}return(e,t)=>(s.openBlock(),s.createElementBlock("form",pa,[s.createBaseVNode("div",fa,[s.createBaseVNode("span",null,s.toDisplayString(p.value),1)]),s.createBaseVNode("div",va,[r.value?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).failure,class:"link-account-failed",alt:"Account link failure"},null,8,["src"])):(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,class:"link-account-icon",src:m.value,alt:f.value},null,8,["src","alt"])),r.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",ma,[s.createBaseVNode("strong",null,s.toDisplayString(e.identifier),1)]))]),s.createBaseVNode("div",ga,s.toDisplayString(v.value),1),r.value?(s.openBlock(),s.createElementBlock("button",{key:1,class:"button is-primary",onClick:s.withModifiers(g,["prevent"])},s.toDisplayString(s.unref(n)("return-to-login")),1)):(s.openBlock(),s.createElementBlock("button",{key:0,class:"button is-primary",onClick:s.withModifiers(y,["prevent"])},s.toDisplayString(s.unref(n)("link-account")),1)),ya,r.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",ha,[s.createBaseVNode("a",{onClick:s.withModifiers(g,["prevent"]),role:"button"},s.toDisplayString(s.unref(n)("cancel")),1)]))]))}}),ba={class:"link-account auth-flex-container"},Ba=s.defineComponent({__name:"LinkAccountView",props:{identifier:{},code:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",ba,[s.createVNode(ka,{identifier:e.identifier,code:e.code},null,8,["identifier","code"])]))}),Va={component:be},wa={component:Fe},Ia={component:$e},Na={component:Ft},_a={component:at},Ca={component:an},Sa={component:Pe},xa={component:En},Ea={component:jn},Da={component:ta},Ta={component:da},La={component:Ba},Ma={passage_container_background_color:"--passage-container-background-color-default",passage_container_max_width:"--passage-container-max-width-default",passage_input_box_background_color:"--passage-input-box-background-color-default",passage_input_box_border_radius:"--passage-input-box-border-radius-default",passage_header_font_family:"--passage-header-font-family-default",passage_body_font_family:"--passage-body-font-family-default",passage_header_text_color:"--passage-header-text-color-default",passage_body_text_color:"--passage-body-text-color-default",passage_primary_button_background_color:"--passage-primary-button-background-color-default",passage_primary_button_text_color:"--passage-primary-button-text-color-default",passage_primary_button_hover_color:"--passage-primary-button-background-hover-color-default",passage_primary_button_border_radius:"--passage-primary-button-border-radius-default",passage_primary_button_border_color:"--passage-primary-button-border-color-default",passage_primary_button_border_width:"--passage-primary-button-border-width-default",passage_secondary_button_background_color:"--passage-secondary-button-background-color-default",passage_secondary_button_text_color:"-passage-secondary-button-text-color-default",passage_secondary_button_hover_color:"--passage-secondary-button-background-hover-color-default",passage_secondary_button_border_radius:"--passage-secondary-button-border-radius-default",passage_secondary_button_border_color:"--passage-secondary-button-border-color-default",passage_secondary_button_border_width:"--passage-secondary-button-border-width-default"},Aa={passage_container_max_width:"passage_container_max_width",passage_input_box_border_radius:"passage_input_box_border_radius",passage_primary_button_border_radius:"passage_primary_button_border_radius",passage_primary_button_border_width:"passage_primary_button_border_width",passage_secondary_button_border_radius:"passage_secondary_button_border_radius",passage_secondary_button_border_width:"passage_secondary_button_border_width"};class Ra{constructor(e){this._homeRoute=Va,this._history=[],void 0!==e&&(this._homeRoute=e)}get homeRoute(){return this._homeRoute}set homeRoute(e){this._homeRoute=e}get currentRoute(){if(0!==this._history.length)return this._history[this._history.length-1]}push(e,l){var s;this._history.push((s=((e,t)=>{for(var n in t||(t={}))o.call(t,n)&&r(e,n,t[n]);if(a)for(var n of a(t))i.call(t,n)&&r(e,n,t[n]);return e})({},e),t(s,n({props:l}))))}resetRouter(){this._history=[]}}const Ua={class:"debug-router"},Pa=s.createBaseVNode("div",{class:"section-label"},"View",-1),Oa=s.createBaseVNode("div",{class:"section-label"},"Props",-1),Fa={key:0},ja=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),$a=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),za={key:1},Ha=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),Ga=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),Wa=s.createBaseVNode("div",{class:"control-label"},"User Is Verifying",-1),Ka={key:2},qa=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),Ya=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),Za=s.createBaseVNode("div",{class:"control-label"},"Setup New Device",-1),Ja=s.createBaseVNode("div",{class:"control-label"},"User Is Registering",-1),Qa=s.createBaseVNode("div",{class:"control-label"},"Verifying Identifier",-1),Xa={key:3},eo=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),to=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),no=s.createBaseVNode("div",{class:"control-label"},"Setup New Device",-1),ao=s.createBaseVNode("div",{class:"control-label"},"User Is Registering",-1),oo=s.createBaseVNode("div",{class:"control-label"},"Verifying Identifier",-1),io={key:4},ro=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),lo=s.createBaseVNode("div",{class:"control-label"},"Social Connection",-1),so=s.createBaseVNode("div",{class:"control-label"},"Code",-1),co={key:5},uo=s.createBaseVNode("div",{class:"control-label"},"Magic Link",-1),po={key:6},fo="authenticator@passage.id",vo=(s.defineComponent({__name:"DebugRouter",props:{router:{},appInfo:{}},setup(e){const t=e,n=s.ref([{name:"Main View",value:{route:t.router.homeRoute,key:"MAINVIEW"}},{name:"Register Device",value:{route:Na,key:"REGISTERDEVICE"}},{name:"Webauthnn Login",value:{route:Ca,key:"WEBAUTHNSIGNIN"}},{name:"One Time Passcode",value:{route:xa,key:"OTP"}},{name:"Magic Link",value:{route:_a,key:"MAGICLINK"}},{name:"Activate Magic Link",value:{route:Sa,key:"ACTIVATEMAGICLINK"}},{name:"Add Device",value:{route:Ea,key:"ADDDEVICE"}},{name:"Device Not Supported",value:{route:Da,key:"DEVICENOTSUPPORTED"}},{name:"Login Not Supported",value:{route:Ta,key:"LOGINNOTSUPPORTED"}},{name:"Link Account",value:{route:La,key:"LINKACCOUNT"}}]),a=s.ref(n.value[0].value),{passage:o}=s.usePassage();o.getCredentialAvailable().then((e=>l.passkeyFeatures=e)),o.getCurrentSession().getAuthToken().then((e=>{m.authResult.auth_token=e})).catch((()=>{}));const i=[{name:"Email",value:d.email},{name:"Phone",value:d.phone}],r=s.reactive({register:!1,appInfo:t.appInfo}),l=s.reactive({identifier:fo,identifierType:d.email,appInfo:t.appInfo,passkeyFeatures:{securityKey:!0,platform:!0,syncedCredential:!0,crossDeviceCredential:!0,conditionalUI:!0,isAvailable:!0}}),u=s.reactive({identifier:fo,identifierType:d.email,appInfo:t.appInfo,userIsVerifying:!1}),p=s.reactive({identifier:fo,identifierType:d.email,setupNewDevice:!1,userIsRegistering:!1,identifierVerifying:!1}),f=s.reactive({identifier:fo,identifierType:d.email,setupNewDevice:!1,userIsRegistering:!1,identifierVerifying:!1}),v=s.reactive({magicLink:"",webauthnAllowed:!0}),m=s.reactive({authResult:{redirect_url:t.appInfo.redirect_url,auth_token:""}}),g=s.reactive({identifier:fo,code:"1234"}),y=s.ref(s.ne.Google),h=[{name:"Google",value:s.ne.Google},{name:"Github",value:s.ne.Github},{name:"Apple",value:s.ne.Apple}];function k(){let e;switch(a.value.key){case"MAINVIEW":e=r;break;case"REGISTERDEVICE":e=l;break;case"WEBAUTHNSIGNIN":e=u;break;case"OTP":e=p;break;case"MAGICLINK":e=f;break;case"ACTIVATEMAGICLINK":e=v;break;case"ADDDEVICE":e=m;break;case"LINKACCOUNT":e=g,sessionStorage.setItem("oauth2Connection",y.value);break;case"DEVICENOTSUPPORTED":case"LOGINNOTSUPPORTED":e=void 0}t.router.push(a.value.route,e)}return(e,t)=>(s.openBlock(),s.createElementBlock("div",Ua,[Pa,s.createVNode(s.Dropdown,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),items:n.value},null,8,["modelValue","items"]),Oa,"REGISTERDEVICE"===a.value.key?(s.openBlock(),s.createElementBlock("div",Fa,[ja,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,l.identifier]]),$a,s.createVNode(s.Dropdown,{modelValue:l.identifierType,"onUpdate:modelValue":t[2]||(t[2]=e=>l.identifierType=e),items:i},null,8,["modelValue"])])):"WEBAUTHNSIGNIN"===a.value.key?(s.openBlock(),s.createElementBlock("div",za,[Ha,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,u.identifier]]),Ga,s.createVNode(s.Dropdown,{modelValue:u.identifierType,"onUpdate:modelValue":t[4]||(t[4]=e=>u.identifierType=e),items:i},null,8,["modelValue"]),Wa,s.createVNode(c.Checkbox,{modelValue:u.userIsVerifying,"onUpdate:modelValue":t[5]||(t[5]=e=>u.userIsVerifying=e)},null,8,["modelValue"])])):"OTP"===a.value.key?(s.openBlock(),s.createElementBlock("div",Ka,[qa,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>p.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,p.identifier]]),Ya,s.createVNode(s.Dropdown,{modelValue:p.identifierType,"onUpdate:modelValue":t[7]||(t[7]=e=>p.identifierType=e),items:i},null,8,["modelValue"]),Za,s.createVNode(c.Checkbox,{modelValue:p.setupNewDevice,"onUpdate:modelValue":t[8]||(t[8]=e=>p.setupNewDevice=e)},null,8,["modelValue"]),Ja,s.createVNode(c.Checkbox,{modelValue:p.userIsRegistering,"onUpdate:modelValue":t[9]||(t[9]=e=>p.userIsRegistering=e)},null,8,["modelValue"]),Qa,s.createVNode(c.Checkbox,{modelValue:p.identifierVerifying,"onUpdate:modelValue":t[10]||(t[10]=e=>p.identifierVerifying=e)},null,8,["modelValue"])])):"MAGICLINK"===a.value.key?(s.openBlock(),s.createElementBlock("div",Xa,[eo,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>f.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,f.identifier]]),to,s.createVNode(s.Dropdown,{modelValue:f.identifierType,"onUpdate:modelValue":t[12]||(t[12]=e=>f.identifierType=e),items:i},null,8,["modelValue"]),no,s.createVNode(c.Checkbox,{modelValue:f.setupNewDevice,"onUpdate:modelValue":t[13]||(t[13]=e=>f.setupNewDevice=e)},null,8,["modelValue"]),ao,s.createVNode(c.Checkbox,{modelValue:f.userIsRegistering,"onUpdate:modelValue":t[14]||(t[14]=e=>f.userIsRegistering=e)},null,8,["modelValue"]),oo,s.createVNode(c.Checkbox,{modelValue:f.identifierVerifying,"onUpdate:modelValue":t[15]||(t[15]=e=>f.identifierVerifying=e)},null,8,["modelValue"])])):"LINKACCOUNT"===a.value.key?(s.openBlock(),s.createElementBlock("div",io,[ro,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>g.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,g.identifier]]),lo,s.createVNode(s.Dropdown,{modelValue:y.value,"onUpdate:modelValue":t[17]||(t[17]=e=>y.value=e),items:h},null,8,["modelValue"]),so,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>g.code=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,g.code]])])):"ACTIVATEMAGICLINK"===a.value.key?(s.openBlock(),s.createElementBlock("div",co,[uo,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>v.magicLink=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,v.magicLink]])])):(s.openBlock(),s.createElementBlock("div",po,"None")),s.createBaseVNode("button",{class:"button",onClick:s.withModifiers(k,["prevent"]),style:{"margin-top":"16px"}},"Go To View")]))}}),s.defineComponent({__name:"DebugPanel",props:{router:{},appInfo:{}},setup(e){s.ref(),s.ref(!1);return(e,t)=>s.createCommentVNode("",!0)}})),mo={key:1,class:"notification is-danger has-text-centered","data-testid":"invalid-app-id"},go=s.defineComponent({__name:"SmartRouter",props:{homeRoute:{},authContainerRef:{},theme:{}},setup(e){const t=e,n=s.reactive(new Ra(t.homeRoute)),a=s.computed((()=>n.currentRoute)),{t:o}=s.useLocale(),{appInfo:i,loading:r,invalidAppId:c,passage:u}=s.useAppInfo(),{initEventHandler:d}=W(),{setCustomElementStyles:p}={setCustomElementStyles:(e,t,n)=>{const a=n===s.Theme.Light?t.element_customization:t.element_customization_dark;Object.entries(a).forEach((t=>{const[n,a]=t;let o=a;Object.values(Aa).includes(n)&&(o=function(e){return`${e}px`}(a)),e.style.setProperty(Ma[n],o)}))}},f=s.computed((()=>{var e;return null==(e=a.value)?void 0:e.component})),v=s.computed((()=>{var e;const t=null==(e=a.value)?void 0:e.props;return void 0===t?{}:t})),m=s.ref(!1);return s.watch(i,(()=>l(this,null,(function*(){m.value=!1,void 0!==i.value&&void 0!==u.value&&(yield d(i.value,n,u.value),m.value=!0,t.authContainerRef&&p(t.authContainerRef,i.value,t.theme))})))),s.onUpdated((()=>{void 0!==i.value&&null!==t.authContainerRef&&p(t.authContainerRef,i.value,t.theme)})),(e,t)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createVNode(s.Transition,{name:"fade",mode:"out-in",appear:""},{default:s.withCtx((()=>[!s.unref(r)&&m.value?(s.openBlock(),s.createBlock(s.resolveDynamicComponent(f.value),s.normalizeProps(s.mergeProps({key:0},v.value)),{otpInput:s.withCtx((()=>[s.renderSlot(e.$slots,"otpInput")])),loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},16)):s.createCommentVNode("",!0)])),_:3}),s.unref(i)&&m.value?(s.openBlock(),s.createBlock(vo,{key:0,router:n,"app-info":s.unref(i)},null,8,["router","app-info"])):s.createCommentVNode("",!0),s.unref(c)?(s.openBlock(),s.createElementBlock("div",mo,s.toDisplayString(s.unref(o)("invalid-app-id")),1)):s.createCommentVNode("",!0)],64))}});exports.AuthRoute=Va,exports.LoginRoute=wa,exports.RegisterRoute=Ia,exports._sfc_main=go,exports.useElementSetup=function(e){function t(){e.appId&&s.createPassageInstance(e.appId,e.tokenStore);const{updateDefaultCountryCode:t}=s.useDefaultCountryCode();t(e.defaultCountryCode);const{setBeforeAuth:n,setOnSuccess:a,setOnEvent:o}=L();n(e.beforeAuth),a(e.onSuccess),o(e.onEvent)}t(),s.onBeforeUpdate((()=>{t()}));const{languageLoading:n}=s.useStoreLocale(e),{currentTheme:a}=s.useThemeSetup(e),o=s.ref();return s.useIntlTelInput(o),{languageLoading:n,containerRef:o,currentTheme:a}};
//# 
